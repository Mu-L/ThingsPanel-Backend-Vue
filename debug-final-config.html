<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>最终配置显示测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-section {
            background: #e6f7ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #1890ff;
        }
        .test-components {
            background: #f6ffed;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #52c41a;
        }
        .non-test-components {
            background: #fff1f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ff4d4f;
        }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .component-card {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            padding: 15px;
            text-align: center;
        }
        .component-card.show-config {
            border-color: #52c41a;
            background: #f6ffed;
        }
        .component-card.hide-config {
            border-color: #ff4d4f;
            background: #fff1f0;
        }
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #40a9ff;
        }
        .code {
            background: #f6f8fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            white-space: pre-wrap;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 最终配置显示测试</h1>
        
        <div class="status-section">
            <h3>📋 最终策略确认</h3>
            <p><strong>✅ 显示配置：</strong>只有test目录下的3个测试组件</p>
            <p><strong>❌ 隐藏配置：</strong>所有统计组件（access-num、alarm-info、alarm-count）</p>
            <p><strong>🎯 三数据组件：</strong>triple-data-display应该正常显示11个配置项</p>
        </div>

        <div class="component-grid">
            <!-- 应该显示配置的组件 -->
            <div class="component-card show-config">
                <h4>✅ simple-display</h4>
                <p><strong>类型：</strong>test组件</p>
                <p><strong>配置：</strong>应显示 (7项)</p>
                <p><strong>数据源：</strong>不显示</p>
            </div>
            
            <div class="component-card show-config">
                <h4>✅ dual-data-display</h4>
                <p><strong>类型：</strong>test组件</p>
                <p><strong>配置：</strong>应显示 (9项)</p>
                <p><strong>数据源：</strong>应显示 (2个数据源)</p>
            </div>
            
            <div class="component-card show-config">
                <h4>✅ triple-data-display</h4>
                <p><strong>类型：</strong>test组件</p>
                <p><strong>配置：</strong>应显示 (11项)</p>
                <p><strong>数据源：</strong>应显示 (3个数据源)</p>
            </div>

            <!-- 不应该显示配置的组件 -->
            <div class="component-card hide-config">
                <h4>❌ access-num</h4>
                <p><strong>类型：</strong>统计组件</p>
                <p><strong>配置：</strong>不显示</p>
                <p><strong>数据源：</strong>不显示</p>
            </div>
            
            <div class="component-card hide-config">
                <h4>❌ alarm-info</h4>
                <p><strong>类型：</strong>统计组件</p>
                <p><strong>配置：</strong>不显示</p>
                <p><strong>数据源：</strong>不显示</p>
            </div>
            
            <div class="component-card hide-config">
                <h4>❌ alarm-count</h4>
                <p><strong>类型：</strong>统计组件</p>
                <p><strong>配置：</strong>不显示</p>
                <p><strong>数据源：</strong>不显示</p>
            </div>
        </div>

        <div class="test-components">
            <h4>✅ Test组件配置面板结构</h4>
            <div class="code">选中test组件后应该显示的标签页：

📋 基础配置 (base) - 所有组件都有
🔧 组件配置 (component) - 只有test组件显示
📊 数据源配置 (dataSource) - 只有dual/triple显示  
🔗 交互配置 (interaction) - 所有组件都有</div>
        </div>

        <div class="non-test-components">
            <h4>❌ 统计组件配置面板结构</h4>
            <div class="code">选中统计组件后应该显示的标签页：

📋 基础配置 (base) - 所有组件都有
🔗 交互配置 (interaction) - 所有组件都有

不显示：
🔧 组件配置 (component) - 被过滤掉
📊 数据源配置 (dataSource) - 被过滤掉</div>
        </div>

        <h3>🧪 测试验证</h3>
        
        <button class="btn" onclick="window.open('http://localhost:5002/test/panel-editor-v2', '_blank')">
            🚀 打开Panel Editor V2
        </button>
        
        <div style="margin: 20px 0;">
            <h4>测试步骤：</h4>
            <ol>
                <li>添加 <strong>triple-data-display</strong> 组件并选中</li>
                <li>检查右侧配置面板应显示4个标签页</li>
                <li>点击"组件配置"标签，应看到11个配置项</li>
                <li>添加 <strong>alarm-count</strong> 组件并选中</li>
                <li>检查右侧配置面板应只显示2个标签页（基础配置+交互配置）</li>
                <li>查看控制台的 <code>[ComponentRegistry-Final]</code> 日志</li>
            </ol>
        </div>

        <h3>🔍 预期的控制台日志</h3>
        
        <button class="btn" onclick="showTripleDataLogs()">📊 三数据组件日志</button>
        <button class="btn" onclick="showAlarmCountLogs()">❌ 统计组件日志</button>
        
        <div id="logOutput" style="margin-top: 20px;"></div>
    </div>

    <script>
        function showTripleDataLogs() {
            const output = document.getElementById('logOutput');
            output.innerHTML = `
                <div class="test-components">
                    <h4>📊 选中triple-data-display时的预期日志</h4>
                    <div class="code">[ComponentRegistry-Final] 检查组件配置显示条件
widgetType: "triple-data-display"

[ComponentRegistry-Final] 确认test组件，显示配置: triple-data-display
[ComponentRegistry-Final] 组件层级检查: true

[ComponentRegistry-Final] 确认需数据源组件: triple-data-display  
[ComponentRegistry-Final] 数据源层级检查: true

[ComponentRegistry-Final] 最终可见层级
layerNames: ["base", "component", "dataSource", "interaction"]
说明: "测试组件，显示相应配置"</div>
                </div>
            `;
        }

        function showAlarmCountLogs() {
            const output = document.getElementById('logOutput');
            output.innerHTML = `
                <div class="non-test-components">
                    <h4>❌ 选中alarm-count时的预期日志</h4>
                    <div class="code">[ComponentRegistry-Final] 检查组件配置显示条件
widgetType: "alarm-count"

[ComponentRegistry-Final] 非test组件，隐藏配置: alarm-count
[ComponentRegistry-Final] 组件层级检查: false

[ComponentRegistry-Final] 确认无数据源组件: alarm-count
[ComponentRegistry-Final] 数据源层级检查: false

[ComponentRegistry-Final] 最终可见层级  
layerNames: ["base", "interaction"]
说明: "统计组件，只显示基础和交互配置"</div>
                </div>
            `;
        }

        // 页面加载时的状态显示
        window.onload = function() {
            console.log('🎯 最终配置显示测试页面已加载');
            console.log('✅ Test组件 (显示配置): simple-display, dual-data-display, triple-data-display');
            console.log('❌ 统计组件 (隐藏配置): access-num, alarm-info, alarm-count');
            console.log('📋 ConfigurationPanel导入: component-registry-final');
        };
    </script>
</body>
</html>