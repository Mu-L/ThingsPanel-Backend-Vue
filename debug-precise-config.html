<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>精准配置显示测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-section {
            background: #e6f7ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #1890ff;
        }
        .should-show {
            background: #f6ffed;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #52c41a;
        }
        .should-hide {
            background: #fff1f0;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ff4d4f;
        }
        .code {
            background: #f6f8fa;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #40a9ff;
        }
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .component-card {
            border: 1px solid #d9d9d9;
            border-radius: 6px;
            padding: 15px;
        }
        .component-card.show-config {
            border-color: #52c41a;
            background: #f6ffed;
        }
        .component-card.hide-config {
            border-color: #ff4d4f;
            background: #fff1f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 精准配置显示测试</h1>
        
        <div class="status-section">
            <h3>精准模式策略</h3>
            <p><strong>原则：</strong>只有真正有settingConfig.ts的组件才显示配置面板</p>
            <p><strong>目标：</strong>避免无配置组件显示空的配置面板，确保三数据组件正常显示配置</p>
        </div>

        <h3>📋 Card2.1组件配置显示预期</h3>
        
        <div class="component-grid">
            <!-- 应该显示配置的组件 -->
            <div class="component-card show-config">
                <h4>✅ simple-display</h4>
                <p><strong>状态：</strong>应该显示配置</p>
                <p><strong>原因：</strong>有settingConfig.ts (7个配置项)</p>
                <div class="code">配置项：标题、内容、颜色、字体、图标等</div>
            </div>
            
            <div class="component-card show-config">
                <h4>✅ dual-data-display</h4>
                <p><strong>状态：</strong>应该显示配置</p>
                <p><strong>原因：</strong>有settingConfig.ts (9个配置项)</p>
                <div class="code">配置项：双数据源展示配置</div>
            </div>
            
            <div class="component-card show-config">
                <h4>✅ triple-data-display</h4>
                <p><strong>状态：</strong>应该显示配置</p>
                <p><strong>原因：</strong>有settingConfig.ts (11个配置项)</p>
                <div class="code">配置项：标题、数据源标签、布局、样式等</div>
            </div>
            
            <div class="component-card show-config">
                <h4>✅ alarm-count</h4>
                <p><strong>状态：</strong>应该显示配置</p>
                <p><strong>原因：</strong>有settingConfig.ts</p>
                <div class="code">配置项：统计组件相关配置</div>
            </div>

            <!-- 不应该显示配置的组件 -->
            <div class="component-card hide-config">
                <h4>❌ access-num</h4>
                <p><strong>状态：</strong>不应该显示配置</p>
                <p><strong>原因：</strong>只有AccessNumCard.vue，无settingConfig.ts</p>
                <div class="code">文件：只有组件本身，没有配置定义</div>
            </div>
            
            <div class="component-card hide-config">
                <h4>❌ alarm-info</h4>
                <p><strong>状态：</strong>不应该显示配置</p>
                <p><strong>原因：</strong>只有AlarmInfoCard.vue，无settingConfig.ts</p>
                <div class="code">文件：只有组件本身，没有配置定义</div>
            </div>
        </div>

        <h3>🧪 测试步骤</h3>
        
        <ol>
            <li>
                <button class="btn" onclick="window.open('http://localhost:5002/test/panel-editor-v2', '_blank')">
                    🚀 打开测试页面
                </button>
                <p>打开Panel Editor V2测试页面</p>
            </li>
            <li>逐一测试每个组件：
                <ul>
                    <li>添加 <strong>simple-display</strong> - 应该显示配置面板</li>
                    <li>添加 <strong>triple-data-display</strong> - 应该显示配置面板（11个配置项）</li>
                    <li>添加 <strong>access-num</strong> - 不应该显示配置面板</li>
                    <li>添加 <strong>alarm-info</strong> - 不应该显示配置面板</li>
                </ul>
            </li>
            <li>查看浏览器控制台的调试日志</li>
        </ol>

        <h3>🔍 预期的控制台日志</h3>
        
        <div class="should-show">
            <h4>选中有配置组件时（如triple-data-display）：</h4>
            <div class="code">[ComponentRegistry-Precise] 检查组件配置显示条件
[ComponentRegistry-Precise] 确认有settingConfig的组件: triple-data-display
[ComponentRegistry-Precise] 组件层级检查: true
[ComponentRegistry-Precise] 确认需数据源组件: triple-data-display  
[ComponentRegistry-Precise] 数据源层级检查: true
[ComponentRegistry-Precise] 最终可见层级: ["base", "component", "dataSource", "interaction"]</div>
        </div>

        <div class="should-hide">
            <h4>选中无配置组件时（如access-num）：</h4>
            <div class="code">[ComponentRegistry-Precise] 检查组件配置显示条件
[ComponentRegistry-Precise] 确认无settingConfig的组件: access-num
[ComponentRegistry-Precise] 组件层级检查: false
[ComponentRegistry-Precise] 确认无数据源组件: access-num
[ComponentRegistry-Precise] 数据源层级检查: false
[ComponentRegistry-Precise] 最终可见层级: ["base", "interaction"]</div>
        </div>

        <h3>🎯 修复验证</h3>
        
        <button class="btn" onclick="showSuccess()">✅ 显示成功标志</button>
        <button class="btn" onclick="showProblem()">❌ 显示问题排查</button>
        
        <div id="resultOutput" style="margin-top: 20px;"></div>
    </div>

    <script>
        function showSuccess() {
            const output = document.getElementById('resultOutput');
            output.innerHTML = `
                <div class="should-show">
                    <h4>🎉 精准模式修复成功的标志</h4>
                    <ul>
                        <li>✅ triple-data-display显示配置面板，包含11个配置项</li>
                        <li>✅ simple-display和dual-data-display正常显示配置</li>
                        <li>❌ access-num和alarm-info不显示配置面板（只显示基础配置和交互配置）</li>
                        <li>📊 控制台有详细的 [ComponentRegistry-Precise] 日志</li>
                        <li>🔍 每个组件的配置显示决策都有明确的原因说明</li>
                    </ul>
                </div>
            `;
        }

        function showProblem() {
            const output = document.getElementById('resultOutput');
            output.innerHTML = `
                <div class="should-hide">
                    <h4>🚨 如果仍有问题，检查以下几点</h4>
                    <ol>
                        <li><strong>ConfigurationPanel导入检查：</strong>确认使用component-registry-precise</li>
                        <li><strong>组件类型检查：</strong>查看控制台widget?.type的值是否正确</li>
                        <li><strong>白名单更新：</strong>如果有新组件，需要更新componentsWithSettingConfig列表</li>
                        <li><strong>缓存清理：</strong>清理浏览器缓存和重启开发服务器</li>
                    </ol>
                    <div class="code">调试命令：
F12 -> Console -> 输入：
console.log('当前选中组件:', selectedWidget?.type)
console.log('组件元数据:', selectedWidget?.metadata)</div>
                </div>
            `;
        }

        // 页面加载时的状态检查
        window.onload = function() {
            console.log('🎯 精准配置显示测试页面加载完成');
            console.log('📋 策略：只有有settingConfig.ts的组件显示配置面板');
            console.log('✅ 应显示配置: simple-display, dual-data-display, triple-data-display, alarm-count');
            console.log('❌ 不应显示配置: access-num, alarm-info');
        };
    </script>
</body>
</html>