// 修复 isDataFromWarehouse 判断逻辑

    // 🔥 关键修复：检查数据是否来自DataWarehouse且包含组件需要的字段
    // 支持嵌套结构（如 { main: { data: { value, ... } } }）
    const isDataFromWarehouse = hasValidDataSource && (() => {
      const dataKeys = Object.keys(currentData)

      // 检查顶层是否包含组件需要的基本字段
      const hasDirectFields = dataKeys.some(key =>
        ['value', 'unit', 'metricsName', 'data', 'title', 'amount', 'description', 'timestamp'].includes(key)
      )

      if (hasDirectFields) return true

      // 🔥 关键修复：检查是否是数据源嵌套结构（如 { main: { data: {...} }, secondary: {...} }）
      const hasNestedData = dataKeys.some(key => {
        const value = currentData[key]
        return value && typeof value === 'object' && ('data' in value || 'type' in value)
      })

      return hasNestedData
    })()