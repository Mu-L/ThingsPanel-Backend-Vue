<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内部菜单数据测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .json-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 16px 0;
        }
        .result-block {
            background: #e7f3ff;
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
        }
        .menu-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>🔍 内部菜单数据处理测试</h1>
    
    <div class="test-section">
        <h3>原始API数据（你提供的）：</h3>
        <div class="json-block" id="original-data"></div>
    </div>

    <div class="test-section">
        <h3>flattenRoutes 函数处理结果：</h3>
        <div class="result-block" id="flattened-result"></div>
    </div>

    <div class="test-section">
        <h3>预期的下拉选项格式：</h3>
        <div class="result-block" id="dropdown-options"></div>
    </div>

    <script>
        // 你提供的原始数据
        const originalData = {
            "code": 200,
            "message": "操作成功",
            "data": {
                "list": [
                    {
                        "id": "a190f7a5-1501-3814-9dd1-f3e1fbe7265e",
                        "parent_id": "0",
                        "element_code": "home",
                        "element_type": 3,
                        "orders": 0,
                        "param1": "/home",
                        "param2": "mdi:alpha-f-box-outline",
                        "param3": "self",
                        "authority": "[\"SYS_ADMIN\",\"TENANT_ADMIN\"]",
                        "description": "首页",
                        "remark": "home",
                        "multilingual": "route.home",
                        "route_path": "layout.base$view.home",
                        "children": []
                    },
                    {
                        "id": "5373a6a2-1861-af35-eb4c-adfd5ca55ecd",
                        "parent_id": "0",
                        "element_code": "device",
                        "element_type": 1,
                        "orders": 112,
                        "param1": "/device",
                        "param2": "icon-park-outline:workbench",
                        "param3": "0",
                        "authority": "[\"TENANT_ADMIN\"]",
                        "description": "设备接入",
                        "remark": "",
                        "multilingual": "route.device",
                        "route_path": "layout.base",
                        "children": [
                            {
                                "id": "c4dff952-3bf4-8102-6882-e9d3f3cffbda",
                                "parent_id": "5373a6a2-1861-af35-eb4c-adfd5ca55ecd",
                                "element_code": "device_manage",
                                "element_type": 3,
                                "orders": 1121,
                                "param1": "/device/manage",
                                "param2": "icon-park-outline:analysis",
                                "param3": "0",
                                "authority": "[\"TENANT_ADMIN\",\"SYS_ADMIN\"]",
                                "description": "设备管理",
                                "remark": "",
                                "multilingual": "route.device_manage",
                                "route_path": "view.device_manage",
                                "children": []
                            },
                            {
                                "id": "75785418-a5af-d790-0783-e4ee4e42521e",
                                "parent_id": "5373a6a2-1861-af35-eb4c-adfd5ca55ecd",
                                "element_code": "device_grouping",
                                "element_type": 3,
                                "orders": 1122,
                                "param1": "/device/grouping",
                                "param2": "material-symbols:grid-on-outline-sharp",
                                "param3": "0",
                                "authority": "[\"TENANT_ADMIN\",\"SYS_ADMIN\"]",
                                "description": "设备分组",
                                "remark": "",
                                "multilingual": "route.device_grouping",
                                "route_path": "view.device_grouping",
                                "children": []
                            }
                        ]
                    },
                    {
                        "id": "95e2a961-382b-f4a6-87b3-1898123c95bc",
                        "parent_id": "0",
                        "element_code": "visualization",
                        "element_type": 1,
                        "orders": 113,
                        "param1": "/visualization",
                        "param2": "icon-park-outline:data-server",
                        "param3": "self",
                        "authority": "[\"TENANT_ADMIN\",\"SYS_ADMIN\"]",
                        "description": "可视化",
                        "remark": "",
                        "multilingual": "route.visualization",
                        "route_path": "layout.base",
                        "children": [
                            {
                                "id": "a2654c98-3749-c88b-0472-b414049ca532",
                                "parent_id": "95e2a961-382b-f4a6-87b3-1898123c95bc",
                                "element_code": "route.visualization_kanban",
                                "element_type": 3,
                                "orders": 1131,
                                "param1": "/visualization/kanban",
                                "param2": "tabler:device-tv",
                                "param3": "self",
                                "authority": "[\"TENANT_ADMIN\",\"SYS_ADMIN\"]",
                                "description": "看板",
                                "remark": "",
                                "multilingual": "route.visualization_kanban",
                                "route_path": "view.visualization_panel",
                                "children": []
                            }
                        ]
                    }
                ]
            }
        };

        // 复制你的 flattenRoutes 函数
        function flattenRoutes(routes, prefix = '') {
            const options = [];
            
            for (const route of routes) {
                // 使用 param1 作为路径，description 作为标签
                const path = route.param1;
                const title = route.description || route.multilingual || route.element_code;
                const fullLabel = prefix ? `${prefix} / ${title}` : title;
                
                if (path && title) {
                    options.push({
                        label: fullLabel,
                        value: path
                    });
                }
                
                // 递归处理子路由
                if (route.children && route.children.length > 0) {
                    options.push(...flattenRoutes(route.children, fullLabel));
                }
            }
            
            return options;
        }

        // 测试函数
        function runTest() {
            console.log('🔍 开始测试菜单数据处理...');
            
            // 显示原始数据
            document.getElementById('original-data').textContent = JSON.stringify(originalData, null, 2);
            
            // 处理数据
            const routes = originalData.data.list;
            const flattened = flattenRoutes(routes);
            
            console.log('📊 处理结果:', flattened);
            
            // 显示处理结果
            let resultHtml = '<h4>处理结果 (' + flattened.length + ' 项):</h4>';
            flattened.forEach((item, index) => {
                resultHtml += `<div class="menu-item">${index + 1}. label: "${item.label}" → value: "${item.value}"</div>`;
            });
            
            document.getElementById('flattened-result').innerHTML = resultHtml;
            
            // 显示下拉选项格式
            let dropdownHtml = '<h4>Naive UI 下拉选项:</h4>';
            dropdownHtml += '<div class="json-block">' + JSON.stringify(flattened, null, 2) + '</div>';
            
            document.getElementById('dropdown-options').innerHTML = dropdownHtml;
            
            // 检查是否有数据
            if (flattened.length === 0) {
                alert('❌ 处理结果为空！请检查数据结构');
            } else {
                alert('✅ 处理成功！生成了 ' + flattened.length + ' 个菜单选项');
            }
        }

        // 页面加载完成后运行测试
        document.addEventListener('DOMContentLoaded', runTest);
    </script>
</body>
</html>