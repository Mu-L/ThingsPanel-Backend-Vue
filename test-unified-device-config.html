<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>统一设备配置选择器修复验证</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: #f0f2f5;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .test-header {
      background: linear-gradient(135deg, #722ed1 0%, #9254de 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 28px;
      text-align: center;
    }
    .comparison-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
    }
    .before-after {
      padding: 20px;
      border-radius: 8px;
      border: 2px solid;
    }
    .before {
      background: #fff2f0;
      border-color: #ffccc7;
    }
    .after {
      background: #f6ffed;
      border-color: #b7eb8f;
    }
    .test-step {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      border-left: 4px solid #722ed1;
    }
    .test-step h4 {
      margin: 0 0 12px 0;
      color: #722ed1;
      font-weight: 600;
    }
    .config-flow {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 8px;
      padding: 16px;
      margin: 12px 0;
    }
    .config-flow h5 {
      margin: 0 0 8px 0;
      color: #1890ff;
    }
    .nav-link {
      display: inline-block;
      padding: 12px 24px;
      background: #722ed1;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin-right: 12px;
      margin-bottom: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .nav-link:hover {
      background: #9254de;
      transform: translateY(-2px);
    }
    .highlight {
      background: #fff7e6;
      padding: 12px;
      border-radius: 6px;
      border-left: 4px solid #fa8c16;
      margin: 12px 0;
    }
    .critical-point {
      background: #fff1f0;
      border: 1px solid #ffa39e;
      padding: 16px;
      border-radius: 6px;
      margin: 12px 0;
    }
    .critical-point::before {
      content: "🎯 ";
      font-weight: bold;
      color: #ff4d4f;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>🔧 统一设备配置选择器修复验证</h1>
      <p>区分外面的设备配置（统一选择器）和里面的设备配置（单个参数），修复交互逻辑不一致问题</p>
    </div>

    <div class="comparison-section">
      <div class="before-after before">
        <h3 style="color: #ff4d4f; margin: 0 0 16px 0;">❌ 修复前的问题</h3>
        <ul style="margin: 0; font-size: 14px;">
          <li><strong>外面的设备配置</strong>：添加方式下拉中的"设备配置"</li>
          <li><strong>里面的设备配置</strong>：每个参数详情中的"设备配置"</li>
          <li>两个"设备配置"打开的是不同的表单界面</li>
          <li>功能重复但逻辑不一致，用户困惑</li>
          <li>参数类型选择中不该有设备配置选项</li>
        </ul>
      </div>
      
      <div class="before-after after">
        <h3 style="color: #52c41a; margin: 0 0 16px 0;">✅ 修复后的效果</h3>
        <ul style="margin: 0; font-size: 14px;">
          <li><strong>外面的设备配置</strong>：统一设备配置选择器，一次性生成多个相关参数</li>
          <li><strong>参数类型选择</strong>：只有"手动输入"和"组件属性绑定"两个选项</li>
          <li>逻辑清晰：设备相关参数通过外面统一配置</li>
          <li>避免重复：不在单个参数中提供设备配置</li>
          <li>参数相关性：外面的设备配置处理参数间的关联关系</li>
        </ul>
      </div>
    </div>

    <div class="critical-point">
      <strong>关键修复点</strong>：现在"添加方式"中的"设备配置"会打开 <code>UnifiedDeviceConfigSelector</code>，这个组件专门处理设备相关参数的统一配置和参数间的相关性。
    </div>

    <div class="test-step">
      <h4>🎯 测试步骤1：验证添加方式的设备配置</h4>
      <div class="config-flow">
        <h5>预期行为</h5>
        <ol style="margin: 8px 0 0 0; font-size: 14px;">
          <li>点击"添加Header" → 选择"设备配置"</li>
          <li><strong>应该打开"统一设备配置选择器"抽屉</strong></li>
          <li>可以选择设备、选择需要的参数类型（deviceId、metric等）</li>
          <li>确认后<strong>一次性生成多个相关参数</strong>，避免参数冲突</li>
        </ol>
      </div>
      
      <div class="highlight">
        <strong>关键验证</strong>：设备配置应该打开右侧的抽屉界面，标题为"设备配置"，内容是设备选择器和参数类型复选框。
      </div>
    </div>

    <div class="test-step">
      <h4>🎯 测试步骤2：验证参数类型选择简化</h4>
      <div class="config-flow">
        <h5>预期行为</h5>
        <ol style="margin: 8px 0 0 0; font-size: 14px;">
          <li>添加任意参数后，点击参数的"详情"按钮</li>
          <li>在参数详情中，点击"参数类型"下拉框</li>
          <li><strong>应该只显示2个选项</strong>：</li>
          <ul style="margin: 4px 0; padding-left: 20px;">
            <li>✅ 手动输入</li>
            <li>✅ 组件属性绑定</li>
            <li>❌ <del>设备配置</del>（已移除）</li>
          </ul>
        </ol>
      </div>
      
      <div class="highlight">
        <strong>关键验证</strong>：参数类型下拉框中不应该再有"设备配置"选项，设备相关参数统一通过外面的设备配置添加。
      </div>
    </div>

    <div class="test-step">
      <h4>🎯 测试步骤3：验证设备配置的参数相关性</h4>
      <div class="config-flow">
        <h5>参数相关性处理</h5>
        <p style="margin: 8px 0; font-size: 14px;">
          统一设备配置选择器的优势在于处理参数间的相关性：
        </p>
        <ul style="margin: 8px 0 0 0; font-size: 14px;">
          <li><strong>设备ID</strong>：选择的设备会生成对应的设备ID参数</li>
          <li><strong>指标参数</strong>：根据设备选择相关的指标参数</li>
          <li><strong>避免重复</strong>：不会生成重复的设备ID或指标参数</li>
          <li><strong>批量管理</strong>：可以一次性修改所有设备相关参数</li>
        </ul>
      </div>
    </div>

    <div style="background: #fafafa; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-top: 24px;">
      <h3>🔍 核心修改内容</h3>
      
      <div style="background: #f8f8f8; padding: 16px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 13px; margin: 12px 0;">
// DynamicParameterEditor.vue - handleSelectAddOption()
case 'device':
  // 🔥 修复：设备配置 - 打开统一设备配置选择器
  isUnifiedDeviceConfigVisible.value = true
  isEditingDeviceConfig.value = false // 新建模式
  return // 提前返回，避免重复处理
      </div>

      <div style="background: #f8f8f8; padding: 16px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 13px; margin: 12px 0;">
// templates/index.ts - getRecommendedTemplates()
export function getRecommendedTemplates(): ParameterTemplate[] {
  return [
    PARAMETER_TEMPLATES.find(t => t.id === 'manual')!,
    PARAMETER_TEMPLATES.find(t => t.id === 'component-property-binding')!
    // 🔥 移除：设备配置选项，由外面统一处理
  ]
}
      </div>
    </div>

    <div style="text-align: center; margin-top: 32px; padding: 20px; background: #e6f7ff; border-radius: 8px;">
      <h3>🚀 立即测试修复效果！</h3>
      <p>验证添加方式的设备配置是否正确打开统一设备配置选择器</p>
      <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank" style="font-size: 16px;">
        🔗 测试统一设备配置选择器
      </a>
    </div>
  </div>
</body>
</html>