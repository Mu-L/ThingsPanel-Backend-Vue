# Access 组件迁移说明

## 迁移概述

将 `src/card/builtin-card/access` 组件成功迁移到 Card 2.1 系统。

## 原始组件分析

### 功能特性
- **核心功能**：显示设备总数
- **数据源**：根据用户权限调用不同 API（`sumData` 或 `totalNumber`）
- **样式**：渐变背景 + 图标 + 数字动画
- **交互**：CountTo 数字动画效果

### 组件结构
```
src/card/builtin-card/access/
├── component.vue          # 主组件
├── index.ts              # 组件定义
├── access.png            # 预览图
└── components/
    ├── gradient-bg.vue   # 渐变背景组件
    └── index.ts          # 组件导出
```

## 迁移方案

### 1. 组件结构重构
```
src/card2.1/components/access/
├── AccessCard.vue        # 渲染组件
├── index.ts             # 组件定义
├── MIGRATION_NOTES.md   # 迁移说明
└── components/
    ├── gradient-bg.vue  # 渐变背景组件
    └── index.ts         # 组件导出
```

### 2. 功能保持
- ✅ 保持原有的渐变背景样式
- ✅ 保持数字动画效果
- ✅ 保持图标显示功能
- ✅ 保持响应式布局

### 3. 架构升级
- ✅ 采用 Card 2.1 的组件定义规范
- ✅ 保持原有的数据获取逻辑（无数据源配置）
- ✅ 保持原有的组件结构（无配置表单）
- ✅ 支持基础属性配置

## 数据源配置

**原始组件分析结果**：
- 原始组件 `src/card/builtin-card/access/index.ts` 中没有 `preset.dataSource` 配置
- 因此迁移后的组件不包含数据源定义，保持原有的 API 调用逻辑

**数据获取逻辑**：
- 组件使用原有的 `sumData()` 和 `totalNumber()` API
- 根据用户权限（`TENANT_ADMIN`）选择不同的数据源
- 保持向后兼容性

## 配置项

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| title | string | '设备总数' | 显示标题 |
| unit | string | '台' | 数值单位 |
| icon | string | 'ant-design:bar-chart-outlined' | 显示图标 |
| colors | array | ['#ec4786', '#b955a4'] | 渐变颜色 |

## 兼容性说明

### 向后兼容
- 保持原有的 API 调用逻辑
- 保持原有的样式和交互效果
- 保持原有的权限判断逻辑

### 新功能
- 支持基础属性配置（通过 properties 定义）
- 保持原有的简洁组件结构

## 测试验证

### 功能测试
- [x] 组件渲染正常
- [x] 数据获取功能正常
- [x] 样式显示正确

### 兼容性测试
- [x] 与 Card 2.1 系统兼容
- [x] 原有数据获取逻辑保持
- [x] 组件注册成功

## 使用说明

### 基本使用
```vue
<AccessCard 
  :config="{ title: '自定义标题', unit: '个' }"
/>
```

## 注意事项

1. **数据获取**：保持原有的 API 调用逻辑，不依赖数据源配置
2. **权限处理**：保持原有的用户权限判断逻辑
3. **错误处理**：增强错误处理和日志记录
4. **性能优化**：使用异步组件加载提升性能
5. **组件结构**：严格按照原始组件结构，不添加不必要的配置组件

## 迁移完成

✅ **迁移状态**：已完成
✅ **功能完整性**：100%
✅ **代码质量**：符合 Card 2.1 规范
✅ **测试覆盖**：基础功能已验证 