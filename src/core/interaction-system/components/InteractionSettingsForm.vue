<!-- src/core/interaction-system/components/InteractionSettingsForm.vue -->
<template>
  <div class="interaction-settings-form">
    <!-- Ë°®ÂçïÊ†áÈ¢ò -->
    <div class="form-header">
      <h3 class="form-title">{{ $t('interaction.settings.title') || '‰∫§‰∫íÈÖçÁΩÆ' }}</h3>
      <n-space size="small">
        <n-button size="tiny" type="primary" :disabled="readonly" @click="addInteractionConfig">
          <template #icon>
            <n-icon><AddOutline /></n-icon>
          </template>
          {{ $t('interaction.add') || 'Ê∑ªÂä†‰∫§‰∫í' }}
        </n-button>
        <n-button size="tiny" quaternary :disabled="!hasInteractions" @click="previewInteractions">
          <template #icon>
            <n-icon><PlayOutline /></n-icon>
          </template>
          {{ $t('interaction.preview') || 'È¢ÑËßà' }}
        </n-button>
      </n-space>
    </div>

    <!-- ‰∫§‰∫íÈÖçÁΩÆÂàóË°® -->
    <div v-if="hasInteractions" class="interaction-list">
      <n-card
        v-for="(config, index) in localInteractionConfigs"
        :key="`interaction-${index}`"
        size="small"
        class="interaction-card"
        :class="{ disabled: !config.enabled }"
      >
        <!-- ‰∫§‰∫íÈÖçÁΩÆÂ§¥ÈÉ® -->
        <template #header>
          <div class="interaction-header">
            <div class="interaction-info">
              <n-tag :type="getEventTagType(config.event)" size="small" round>
                {{ getEventDisplayName(config.event) }}
              </n-tag>
              <span class="interaction-title">
                {{ config.name || `${getEventDisplayName(config.event)}‰∫§‰∫í` }}
              </span>
            </div>
            <div class="interaction-actions">
              <n-switch
                v-model:value="config.enabled"
                size="small"
                :disabled="readonly"
                @update:value="handleInteractionChange"
              />
              <n-dropdown
                :options="getInteractionActionOptions(index)"
                trigger="click"
                @select="key => handleInteractionAction(key, index)"
              >
                <n-button size="tiny" quaternary circle>
                  <template #icon>
                    <n-icon><EllipsisHorizontalOutline /></n-icon>
                  </template>
                </n-button>
              </n-dropdown>
            </div>
          </div>
        </template>

        <!-- ‰∫§‰∫íÈÖçÁΩÆÂÜÖÂÆπ -->
        <div class="interaction-content">
          <!-- ‰∫ã‰ª∂ÈÖçÁΩÆ -->
          <n-form label-placement="left" label-width="80" size="small">
            <!-- üî• Á≤æÁÆÄËß¶Âèë‰∫ã‰ª∂ÈÄâÊã©ÔºàÊ∑ªÂä†‰∫ã‰ª∂Â§ÑÁêÜÔºâ -->
            <n-form-item label="Ëß¶Âèë‰∫ã‰ª∂">
              <n-select
                v-model:value="config.event"
                :options="coreEventOptions"
                :disabled="readonly"
                @update:value="value => handleEventChange(value, index)"
              />
            </n-form-item>

            <!-- üî• ÁÆÄÂåñÁïåÈù¢ - È´òÁ∫ßÈÄâÈ°πÂàáÊç¢ÊåâÈíÆ -->
            <div class="advanced-options-toggle">
              <n-button text type="primary" size="small" @click="showAdvancedOptions = !showAdvancedOptions">
                <template #icon>
                  <n-icon>
                    <ChevronDownOutline v-if="!showAdvancedOptions" />
                    <ChevronUpOutline v-else />
                  </n-icon>
                </template>
                {{ showAdvancedOptions ? 'Êî∂Ëµ∑' : 'Â±ïÂºÄ' }}È´òÁ∫ßÈÄâÈ°π
              </n-button>
            </div>

            <!-- ÁÆÄÂåñÂêéÁöÑÈ´òÁ∫ßÈÄâÈ°π - Êù°‰ª∂Ê∏≤Êüì -->
            <template v-if="showAdvancedOptions">
              <n-form-item label="‰ºòÂÖàÁ∫ß">
                <n-input-number
                  v-model:value="config.priority"
                  :min="0"
                  :max="100"
                  :disabled="readonly"
                  @update:value="handleInteractionChange"
                />
              </n-form-item>

              <n-form-item label="ÈÖçÁΩÆÂêçÁß∞">
                <n-input
                  v-model:value="config.name"
                  placeholder="Ëá™ÂÆö‰πâ‰∫§‰∫íÂêçÁß∞"
                  :disabled="readonly"
                  @update:value="handleInteractionChange"
                />
              </n-form-item>
            </template>

            <!-- Ë∑®ÁªÑ‰ª∂ÁõÆÊ†áÈÄâÊã© -->
            <n-form-item v-if="isInterComponentEvent(config.event)" label="ÁõÆÊ†áÁªÑ‰ª∂">
              <n-select
                v-model:value="config.targetComponentId"
                :options="availableComponentOptions"
                placeholder="ÈÄâÊã©ÁõÆÊ†áÁªÑ‰ª∂"
                :disabled="readonly"
                clearable
                @update:value="handleInteractionChange"
              />
            </n-form-item>

            <!-- üî• Êï∞ÊçÆÂèòÂåñÁõëÂê¨ÈÖçÁΩÆÔºàÂ¢ûÂº∫ÁâàÔºâ -->
            <n-form-item v-if="config.event === 'dataChange'" label="ÁõëÂê¨Â±ûÊÄß">
              <n-select
                :value="config.watchedProperty"
                :options="availablePropertyOptions"
                placeholder="ÈÄâÊã©Ë¶ÅÁõëÂê¨ÁöÑÁªÑ‰ª∂Â±ûÊÄß"
                :disabled="readonly"
                filterable
                clearable
                @update:value="value => handleWatchedPropertyChange(value, index)"
              >
                <template #empty>
                  <div style="padding: 12px; text-align: center; color: var(--text-color-3)">
                    <div>ÊöÇÊó†ÂèØÁõëÂê¨Â±ûÊÄß</div>
                    <div style="font-size: 12px; margin-top: 4px">ÁªÑ‰ª∂ÂºÄÂèëËÄÖÈúÄË¶ÅÊö¥Èú≤ÂèØÁõëÂê¨ÁöÑÂ±ûÊÄß</div>
                  </div>
                </template>
              </n-select>
            </n-form-item>

            <!-- ‰º†ÁªüÊï∞ÊçÆË∑ØÂæÑËæìÂÖ•Ôºà‰Ωú‰∏∫Â§áÈÄâÔºâ -->
            <n-form-item v-if="config.event === 'dataChange' && showAdvancedOptions" label="Ëá™ÂÆö‰πâË∑ØÂæÑ">
              <n-input
                v-model:value="config.dataPath"
                placeholder="Â¶Ç: data.temperature Êàñ properties.value"
                :disabled="readonly"
                @update:value="handleInteractionChange"
              />
            </n-form-item>

            <!-- üî• Âè™Êúâ„ÄåÂ±ûÊÄßÊîπÂèòÊó∂„ÄçÊâçÊòæÁ§∫ÊâßË°åÊù°‰ª∂ -->
            <n-form-item v-if="config.event === 'dataChange'" label="ÊâßË°åÊù°‰ª∂">
              <div class="condition-config">
                <n-select
                  :value="config.condition?.type"
                  :options="conditionTypeOptions"
                  placeholder="Êù°‰ª∂Á±ªÂûã"
                  :disabled="readonly"
                  style="width: 120px"
                  @update:value="value => handleConditionTypeChange(value, index)"
                />
                <template v-if="config.condition?.type === 'comparison'">
                  <n-select
                    v-model:value="config.condition.operator"
                    :options="comparisonOperatorOptions"
                    placeholder="ÊØîËæÉ"
                    :disabled="readonly"
                    style="width: 80px"
                    @update:value="handleInteractionChange"
                  />
                  <n-input
                    v-model:value="config.condition.value"
                    placeholder="ÂÄº"
                    :disabled="readonly"
                    style="flex: 1"
                    @update:value="handleInteractionChange"
                  />
                </template>
                <template v-else-if="config.condition?.type === 'range'">
                  <n-input
                    v-model:value="config.condition.minValue"
                    placeholder="ÊúÄÂ∞èÂÄº"
                    :disabled="readonly"
                    style="width: 80px"
                    @update:value="handleInteractionChange"
                  />
                  <span>~</span>
                  <n-input
                    v-model:value="config.condition.maxValue"
                    placeholder="ÊúÄÂ§ßÂÄº"
                    :disabled="readonly"
                    style="width: 80px"
                    @update:value="handleInteractionChange"
                  />
                </template>
                <template v-else-if="config.condition?.type === 'expression'">
                  <n-input
                    v-model:value="config.condition.expression"
                    placeholder="Â¶Ç: value > 99 && value < 200"
                    :disabled="readonly"
                    style="flex: 1"
                    @update:value="handleInteractionChange"
                  />
                </template>
              </div>
            </n-form-item>
          </n-form>

          <!-- ÂìçÂ∫îÂä®‰ΩúÂàóË°® -->
          <div class="responses-section">
            <div class="section-header">
              <span class="section-title">ÂìçÂ∫îÂä®‰Ωú</span>
              <n-button
                size="tiny"
                type="primary"
                dashed
                :disabled="readonly"
                @click="
                  () => {
                    console.log('[INTERACTION-DEBUG] ÁÇπÂáªÊ∑ªÂä†Âä®‰ΩúÊåâÈíÆ(Â§¥ÈÉ®)')
                    addResponse(index)
                  }
                "
              >
                <template #icon>
                  <n-icon><AddOutline /></n-icon>
                </template>
                Ê∑ªÂä†Âä®‰Ωú
              </n-button>
            </div>

            <div v-if="config.responses.length === 0" class="no-responses">
              <n-empty description="ÊöÇÊó†ÂìçÂ∫îÂä®‰Ωú" size="small">
                <template #extra>
                  <n-button
                    size="small"
                    :disabled="readonly"
                    @click="
                      () => {
                        console.log('[INTERACTION-DEBUG] ÁÇπÂáªÊ∑ªÂä†Âä®‰ΩúÊåâÈíÆ(Á©∫Áä∂ÊÄÅ)')
                        addResponse(index)
                      }
                    "
                  >
                    Ê∑ªÂä†Á¨¨‰∏Ä‰∏™Âä®‰Ωú
                  </n-button>
                </template>
              </n-empty>
            </div>

            <div v-else class="responses-list">
              <n-card
                v-for="(response, responseIndex) in config.responses"
                :key="`response-${responseIndex}`"
                size="small"
                class="response-card"
              >
                <template #header>
                  <div class="response-header">
                    <n-tag size="small" type="info">
                      {{ getActionDisplayName(response.action) }}
                    </n-tag>
                    <n-button
                      size="tiny"
                      type="error"
                      quaternary
                      circle
                      :disabled="readonly"
                      @click="removeResponse(index, responseIndex)"
                    >
                      <template #icon>
                        <n-icon><TrashOutline /></n-icon>
                      </template>
                    </n-button>
                  </div>
                </template>

                <!-- ÂìçÂ∫îÂä®‰ΩúÈÖçÁΩÆ -->
                <InteractionResponseEditor
                  v-model="config.responses[responseIndex]"
                  :readonly="readonly"
                  @update="handleInteractionChange"
                />
              </n-card>
            </div>
          </div>
        </div>
      </n-card>
    </div>

    <!-- Á©∫Áä∂ÊÄÅ -->
    <div v-else class="empty-state">
      <n-empty description="ÊöÇÊó†‰∫§‰∫íÈÖçÁΩÆ" size="medium">
        <template #icon>
          <n-icon><FlashOutline /></n-icon>
        </template>
        <template #extra>
          <n-button type="primary" :disabled="readonly" @click="addInteractionConfig">ÂàõÂª∫Á¨¨‰∏Ä‰∏™‰∫§‰∫í</n-button>
        </template>
      </n-empty>
    </div>

    <!-- Ê®°ÊùøÈÄâÊã©ÂØπËØùÊ°Ü -->
    <n-modal v-model:show="showTemplateDialog" :title="$t('interaction.template.title') || 'ÈÄâÊã©‰∫§‰∫íÊ®°Êùø'">
      <n-card style="width: 600px" :bordered="false" size="huge">
        <InteractionTemplateSelector @select="applyTemplate" @cancel="showTemplateDialog = false" />
      </n-card>
    </n-modal>

    <!-- È¢ÑËßàÂØπËØùÊ°Ü -->
    <n-modal v-model:show="showPreviewDialog" :title="$t('interaction.preview.title') || '‰∫§‰∫íÈ¢ÑËßà'">
      <n-card style="width: 800px" :bordered="false" size="huge">
        <InteractionPreview
          :interactions="localInteractionConfigs"
          :component-id="componentId"
          @close="showPreviewDialog = false"
        />
      </n-card>
    </n-modal>
  </div>
</template>

<script setup lang="ts">
/**
 * ‰∫§‰∫íËÆæÁΩÆË°®ÂçïÁªÑ‰ª∂
 * Êèê‰æõÂÆåÊï¥ÁöÑÂèØËßÜÂåñ‰∫§‰∫íÈÖçÁΩÆÁïåÈù¢
 */

import { ref, computed, watch, onMounted, nextTick, inject } from 'vue'
import { useI18n } from 'vue-i18n'
import {
  NCard,
  NButton,
  NIcon,
  NSpace,
  NForm,
  NFormItem,
  NSelect,
  NInputNumber,
  NInput,
  NSwitch,
  NTag,
  NDropdown,
  NEmpty,
  NModal,
  NRadioGroup,
  NRadio,
  NTooltip,
  NCollapseItem,
  useMessage
} from 'naive-ui'
import {
  AddOutline,
  PlayOutline,
  EllipsisHorizontalOutline,
  TrashOutline,
  FlashOutline,
  CopyOutline,
  DocumentOutline,
  SettingsOutline,
  InformationCircleOutline,
  ChevronDownOutline,
  ChevronUpOutline
} from '@vicons/ionicons5'

// ÂØºÂÖ•‰∫§‰∫íÁ≥ªÁªüÁõ∏ÂÖ≥Á±ªÂûãÂíåÂ∑•ÂÖ∑
import type {
  InteractionConfig,
  InteractionEventType,
  InteractionActionType,
  InteractionResponse,
  InteractionTriggerType,
  ConditionConfig,
  ComparisonOperator
} from '@/card2.1/core/interaction-types'
import { interactionManager } from '@/card2.1/core/interaction-manager'
import { propertyExposureRegistry } from '@/card2.1/core/property-exposure'

// ÂØºÂÖ•Â≠êÁªÑ‰ª∂
import InteractionResponseEditor from './InteractionResponseEditor.vue'
import InteractionTemplateSelector from './InteractionTemplateSelector.vue'
import InteractionPreview from './InteractionPreview.vue'

interface Props {
  /** ÁªÑ‰ª∂ID */
  componentId?: string
  /** ÁªÑ‰ª∂Á±ªÂûã */
  componentType?: string
  /** ÂΩìÂâç‰∫§‰∫íÈÖçÁΩÆ */
  modelValue?: InteractionConfig[]
  /** ÊòØÂê¶Âè™ËØª */
  readonly?: boolean
  /** ÊòØÂê¶ÊòæÁ§∫È´òÁ∫ßÂäüËÉΩ */
  showAdvanced?: boolean
}

interface Emits {
  (e: 'update:modelValue', value: InteractionConfig[]): void
  (e: 'change', value: InteractionConfig[]): void
  (e: 'validate', result: { valid: boolean; errors: string[] }): void
}

const props = withDefaults(defineProps<Props>(), {
  modelValue: () => [],
  readonly: false,
  showAdvanced: true
})

const emit = defineEmits<Emits>()
const { t } = useI18n()
const message = useMessage()

// üî• Ê≥®ÂÖ•Visual EditorÁä∂ÊÄÅËé∑ÂèñÁªÑ‰ª∂ÂàóË°®
const visualEditorState = inject<{ getAvailableComponents: () => any[] }>('visualEditorState', {
  getAvailableComponents: () => {
    console.log('[INTERACTION-DEBUG] Visual EditorÁä∂ÊÄÅÊú™Ê≥®ÂÖ•ÔºåËøîÂõûÁ©∫ÁªÑ‰ª∂ÂàóË°®')
    return []
  }
})

// ÂìçÂ∫îÂºèÁä∂ÊÄÅ
const localInteractionConfigs = ref<InteractionConfig[]>([])
const showTemplateDialog = ref(false)
const showPreviewDialog = ref(false)
const showAdvancedOptions = ref(false) // ÊéßÂà∂È´òÁ∫ßÈÄâÈ°πÊòæÁ§∫

// ËÆ°ÁÆóÂ±ûÊÄß
const hasInteractions = computed(() => localInteractionConfigs.value.length > 0)

// üî• 4‰∏™Ê†∏ÂøÉËß¶Âèë‰∫ã‰ª∂ÔºàÁÆÄÂåñÂêéÔºâ
const coreEventOptions = ref([
  { label: 'ÁÇπÂáª', value: 'click' },
  { label: 'ÊÇ¨ÂÅú', value: 'hover' },
  { label: 'ÊòæÁ§∫Êó∂/ÈöêËóèÊó∂', value: 'visibility' },
  { label: 'Â±ûÊÄßÊîπÂèòÊó∂', value: 'dataChange' }
])

// ‰øùÁïôÂéüÊúâÈÄâÈ°πÁî®‰∫éÂêëÂêéÂÖºÂÆπ
const eventTypeOptions = ref([
  { label: 'ÁÇπÂáª', value: 'click' },
  { label: 'ÊÇ¨ÂÅú', value: 'hover' },
  { label: 'ËÅöÁÑ¶', value: 'focus' },
  { label: 'Â§±ÁÑ¶', value: 'blur' },
  { label: 'Êï∞ÊçÆÂèòÂåñ', value: 'dataChange' },
  { label: 'Êù°‰ª∂Ëß¶Âèë', value: 'conditional' },
  { label: 'Ë∑®ÁªÑ‰ª∂', value: 'crossComponent' },
  { label: 'Ëá™ÂÆö‰πâ', value: 'custom' }
])

// üî• 4‰∏™Ê†∏ÂøÉÂä®‰ΩúÔºàÁî®Êà∑Ë¶ÅÊ±ÇÁÆÄÂåñÔºâ
const coreActionOptions = ref([
  { label: 'Ë∑≥ËΩ¨Âà∞URL', value: 'navigateToUrl', category: 'navigation' },
  { label: '‰øÆÊîπÂèØËßÅÊÄß', value: 'changeVisibility', category: 'visibility' },
  { label: '‰øÆÊîπÁªÑ‰ª∂Â±ûÊÄß', value: 'updateComponentData', category: 'property' },
  { label: 'ÁõÆÊ†áÁªÑ‰ª∂Âä®Êïà', value: 'triggerAnimation', category: 'animation' }
])

// ‰øùÁïôÂÆåÊï¥ÈÄâÈ°πÁî®‰∫éÂêëÂêéÂÖºÂÆπ
const actionTypeOptions = ref([
  { label: 'ÊîπÂèòËÉåÊôØÈ¢úËâ≤', value: 'changeBackgroundColor' },
  { label: 'ÊîπÂèòÊñáÂ≠óÈ¢úËâ≤', value: 'changeTextColor' },
  { label: 'ÊîπÂèòËæπÊ°ÜÈ¢úËâ≤', value: 'changeBorderColor' },
  { label: 'ÊîπÂèòÂ§ßÂ∞è', value: 'changeSize' },
  { label: 'ÊîπÂèòÈÄèÊòéÂ∫¶', value: 'changeOpacity' },
  { label: 'ÊîπÂèòÂèòÊç¢', value: 'changeTransform' },
  { label: 'ÊîπÂèòÂèØËßÅÊÄß', value: 'changeVisibility' },
  { label: 'ÊîπÂèòÂÜÖÂÆπ', value: 'changeContent' },
  { label: 'Ëß¶ÂèëÂä®Áîª', value: 'triggerAnimation' },
  { label: 'Ë∑≥ËΩ¨Âà∞URL', value: 'navigateToUrl' },
  { label: '‰øÆÊîπÁªÑ‰ª∂Êï∞ÊçÆ', value: 'updateComponentData' },
  { label: 'Èó™ÁÉÅÈ¢úËâ≤', value: 'flashColor' },
  { label: 'Êù°‰ª∂Ê†∑Âºè', value: 'conditionalStyle' },
  { label: 'Ë∞ÉÁî®ÂáΩÊï∞', value: 'callFunction' },
  { label: 'Ëá™ÂÆö‰πâÂä®‰Ωú', value: 'custom' }
])

// Êù°‰ª∂Á±ªÂûãÈÄâÈ°π
const conditionTypeOptions = ref([
  { label: 'ÊØîËæÉÊù°‰ª∂', value: 'comparison' },
  { label: 'ËåÉÂõ¥Êù°‰ª∂', value: 'range' },
  { label: 'Ë°®ËææÂºè', value: 'expression' }
])

// ÊØîËæÉËøêÁÆóÁ¨¶ÈÄâÈ°π
const comparisonOperatorOptions = ref([
  { label: 'Á≠â‰∫é', value: 'equals' },
  { label: '‰∏çÁ≠â‰∫é', value: 'notEquals' },
  { label: 'Â§ß‰∫é', value: 'greaterThan' },
  { label: 'Â§ß‰∫éÁ≠â‰∫é', value: 'greaterThanOrEqual' },
  { label: 'Â∞è‰∫é', value: 'lessThan' },
  { label: 'Â∞è‰∫éÁ≠â‰∫é', value: 'lessThanOrEqual' },
  { label: 'ÂåÖÂê´', value: 'contains' },
  { label: 'ÂºÄÂ§¥ÊòØ', value: 'startsWith' },
  { label: 'ÁªìÂ∞æÊòØ', value: 'endsWith' }
])

// üî• Âä®ÊÄÅËé∑ÂèñÂèØÁî®ÁªÑ‰ª∂ÈÄâÈ°π
const availableComponentOptions = computed(() => {
  const components = visualEditorState.getAvailableComponents()

  console.log('[INTERACTION-DEBUG] ËÆ°ÁÆóÂèØÁî®ÁªÑ‰ª∂ÈÄâÈ°π:', {
    componentCount: components.length,
    components: components
  })

  return components.map(comp => ({
    label: comp.label || `${comp.name} (${comp.id.slice(0, 8)}...)`,
    value: comp.id
  }))
})

// üî• ÂèØÁî®Â±ûÊÄßÈÄâÈ°π - Âü∫‰∫éÁªÑ‰ª∂Á±ªÂûãÂä®ÊÄÅËé∑Âèñ
const availablePropertyOptions = computed(() => {
  console.log('[INTERACTION-DEBUG] availablePropertyOptions ËÆ°ÁÆó:', {
    componentType: props.componentType,
    registryKeys: propertyExposureRegistry.getAllComponentTypes()
  })

  if (!props.componentType) {
    console.log('[INTERACTION-DEBUG] ‚ùå componentType ‰∏∫Á©∫')
    return []
  }

  // ‰ªéÂ±ûÊÄßÊö¥Èú≤Ê≥®ÂÜåË°®Ëé∑ÂèñÂΩìÂâçÁªÑ‰ª∂Á±ªÂûãÁöÑÂèØÁõëÂê¨Â±ûÊÄß
  const componentExposure = propertyExposureRegistry.getComponentExposure(props.componentType)

  console.log('[INTERACTION-DEBUG] Â±ûÊÄßÊö¥Èú≤Êü•ËØ¢ÁªìÊûú:', {
    componentType: props.componentType,
    componentExposure: componentExposure,
    hasListenableProperties: !!componentExposure?.listenableProperties,
    listenablePropertiesLength: componentExposure?.listenableProperties?.length
  })

  if (!componentExposure || !componentExposure.listenableProperties) {
    console.log('[INTERACTION-DEBUG] ‚ùå Êú™ÊâæÂà∞ÂèØÁõëÂê¨Â±ûÊÄß')
    return []
  }

  // ËΩ¨Êç¢‰∏∫ÈÄâÊã©Âô®ÈÄâÈ°πÊ†ºÂºèÔºåÊåâÂàÜÁªÑÁªÑÁªá
  const groupedOptions: any[] = []
  const groups: Record<string, any[]> = {}

  componentExposure.listenableProperties.forEach(property => {
    const group = property.group || 'ÂÖ∂‰ªñ'
    if (!groups[group]) {
      groups[group] = []
    }

    groups[group].push({
      label: `${property.label}${property.description ? ` (${property.description})` : ''}`,
      value: property.name,
      property // ‰øùÂ≠òÂÆåÊï¥Â±ûÊÄß‰ø°ÊÅØ‰æõÂêéÁª≠‰ΩøÁî®
    })
  })

  // ËΩ¨Êç¢‰∏∫ÂàÜÁªÑÈÄâÈ°πÊ†ºÂºè
  Object.entries(groups).forEach(([groupName, options]) => {
    if (options.length > 0) {
      groupedOptions.push({
        type: 'group',
        label: groupName,
        key: groupName,
        children: options
      })
    }
  })

  return groupedOptions
})

// Ëé∑Âèñ‰∫ã‰ª∂Ê†áÁ≠æÁ±ªÂûãÔºàÊîØÊåÅÊñ∞ÁöÑÊ†∏ÂøÉ‰∫ã‰ª∂Ôºâ
const getEventTagType = (event: InteractionEventType) => {
  const typeMap = {
    click: 'success',
    hover: 'info',
    focus: 'warning',
    blur: 'default',
    visibility: 'primary', // Êñ∞Â¢û
    dataChange: 'primary',
    conditional: 'warning',
    crossComponent: 'info',
    custom: 'error'
  }
  return typeMap[event] || 'default'
}

// Ëé∑Âèñ‰∫ã‰ª∂ÊòæÁ§∫ÂêçÁß∞ÔºàÊîØÊåÅÊñ∞ÁöÑÊ†∏ÂøÉ‰∫ã‰ª∂Ôºâ
const getEventDisplayName = (event: InteractionEventType) => {
  const nameMap = {
    click: 'ÁÇπÂáª',
    hover: 'ÊÇ¨ÂÅú',
    focus: 'ËÅöÁÑ¶',
    blur: 'Â§±ÁÑ¶',
    visibility: 'ÊòæÁ§∫Êó∂/ÈöêËóèÊó∂', // Êñ∞Â¢û
    dataChange: 'Â±ûÊÄßÊîπÂèòÊó∂', // Êõ¥Êñ∞ÊòæÁ§∫ÂêçÁß∞
    conditional: 'Êù°‰ª∂Ëß¶Âèë',
    crossComponent: 'Ë∑®ÁªÑ‰ª∂',
    custom: 'Ëá™ÂÆö‰πâ'
  }
  return nameMap[event] || event
}

// Ëé∑ÂèñÂä®‰ΩúÊòæÁ§∫ÂêçÁß∞
const getActionDisplayName = (action: InteractionActionType) => {
  const nameMap = {
    changeBackgroundColor: 'ËÉåÊôØÈ¢úËâ≤',
    changeTextColor: 'ÊñáÂ≠óÈ¢úËâ≤',
    changeBorderColor: 'ËæπÊ°ÜÈ¢úËâ≤',
    changeSize: 'Â∞∫ÂØ∏',
    changeOpacity: 'ÈÄèÊòéÂ∫¶',
    changeTransform: 'ÂèòÊç¢',
    changeVisibility: 'ÂèØËßÅÊÄß',
    changeContent: 'ÂÜÖÂÆπ',
    triggerAnimation: 'Âä®Áîª',
    navigateToUrl: 'Ë∑≥ËΩ¨URL',
    updateComponentData: 'Êõ¥Êñ∞Êï∞ÊçÆ',
    flashColor: 'Èó™ÁÉÅÈ¢úËâ≤',
    conditionalStyle: 'Êù°‰ª∂Ê†∑Âºè',
    callFunction: 'Ë∞ÉÁî®ÂáΩÊï∞',
    custom: 'Ëá™ÂÆö‰πâ'
  }
  return nameMap[action] || action
}

// Ëé∑Âèñ‰∫§‰∫íÂä®‰ΩúÈÄâÈ°π
const getInteractionActionOptions = (index: number) => [
  {
    label: 'Â§çÂà∂ÈÖçÁΩÆ',
    key: 'copy',
    icon: CopyOutline
  },
  {
    label: 'Â§çÂà∂‰∏∫Ê®°Êùø',
    key: 'duplicate',
    icon: DocumentOutline
  },
  {
    type: 'divider'
  },
  {
    label: 'È´òÁ∫ßËÆæÁΩÆ',
    key: 'advanced',
    icon: SettingsOutline
  },
  {
    type: 'divider'
  },
  {
    label: 'Âà†Èô§ÈÖçÁΩÆ',
    key: 'delete',
    icon: TrashOutline
  }
]

// Âà§Êñ≠ÊòØÂê¶‰∏∫Ë∑®ÁªÑ‰ª∂‰∫ã‰ª∂
const isInterComponentEvent = (event: InteractionEventType) => {
  return event === 'crossComponent' || event === 'updateComponentData'
}

// üî• Ê†πÊçÆËß¶ÂèëÁ±ªÂûãËøáÊª§‰∫ã‰ª∂ÈÄâÈ°π
const getFilteredEventOptions = (triggerType: InteractionTriggerType) => {
  if (triggerType === 'node') {
    // ËäÇÁÇπËß¶ÂèëÔºö‰∏ªË¶ÅÊòØÁÇπÂáª„ÄÅÊÇ¨ÂÅúÁ≠âËäÇÁÇπÁ∫ßÂà´‰∫ã‰ª∂
    return eventTypeOptions.value.filter(option =>
      ['click', 'hover', 'dataChange', 'conditional'].includes(option.value)
    )
  } else if (triggerType === 'component') {
    // ÁªÑ‰ª∂Ëß¶ÂèëÔºöÂåÖÊã¨ÊâÄÊúâ‰∫ã‰ª∂ÔºåÁâπÂà´ÊòØÂÜÖÈÉ®ÂÖÉÁ¥†‰∫§‰∫í
    return eventTypeOptions.value
  } else {
    // ÈªòËÆ§ËøîÂõûÊâÄÊúâÈÄâÈ°π
    return eventTypeOptions.value
  }
}

// üî• ÂàùÂßãÂåñÈÖçÁΩÆÊù°‰ª∂ÔºàÁ°Æ‰øùÂÆâÂÖ®ËÆøÈóÆÔºâ
const initializeCondition = (config: InteractionConfig) => {
  if (!config.condition) {
    config.condition = {
      type: 'comparison',
      operator: 'greaterThan',
      value: ''
    }
  }
}

// üî• Â§ÑÁêÜÊù°‰ª∂Á±ªÂûãÂèòÂåñ
const handleConditionTypeChange = (value: string, configIndex: number) => {
  const config = localInteractionConfigs.value[configIndex]
  // Á°Æ‰øù condition ÂØπË±°Â≠òÂú®
  if (!config.condition) {
    initializeCondition(config)
  }
  // Êõ¥Êñ∞Êù°‰ª∂Á±ªÂûã
  if (config.condition) {
    config.condition.type = value as any
  }
  handleInteractionChange()
}

// üî• Â§ÑÁêÜ‰∫ã‰ª∂Á±ªÂûãÂèòÂåñ
const handleEventChange = (eventType: string, configIndex: number) => {
  const config = localInteractionConfigs.value[configIndex]
  config.event = eventType as any

  // Â¶ÇÊûúÊòØ dataChange ‰∫ã‰ª∂ÔºåÁ°Æ‰øùÂàùÂßãÂåñÊù°‰ª∂ÂíåÊ∫êÁªÑ‰ª∂Á±ªÂûã
  if (eventType === 'dataChange') {
    initializeCondition(config)
    // ËÆæÁΩÆÊ∫êÁªÑ‰ª∂Á±ªÂûãÁî®‰∫éÂ±ûÊÄßÈ™åËØÅ
    config.sourceComponentType = props.componentType
  }

  handleInteractionChange()
}

// üî• Â§ÑÁêÜÁõëÂê¨Â±ûÊÄßÂèòÂåñ
const handleWatchedPropertyChange = (propertyName: string | null, configIndex: number) => {
  const config = localInteractionConfigs.value[configIndex]

  // Êõ¥Êñ∞ÁõëÂê¨ÁöÑÂ±ûÊÄßÂêç
  config.watchedProperty = propertyName || undefined

  // Â¶ÇÊûúËÆæÁΩÆ‰∫ÜÂ±ûÊÄßÔºåÂêåÊó∂ËÆæÁΩÆÊ∫êÁªÑ‰ª∂Á±ªÂûã
  if (propertyName && props.componentType) {
    config.sourceComponentType = props.componentType

    // Ëé∑ÂèñÂ±ûÊÄßÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
    const componentExposure = propertyExposureRegistry.getComponentExposure(props.componentType)
    const property = componentExposure?.listenableProperties?.find(p => p.name === propertyName)

    if (property) {
      // Ê†πÊçÆÂ±ûÊÄßÁ±ªÂûãËá™Âä®ËÆæÁΩÆÂêàÈÄÇÁöÑÊù°‰ª∂ÈÖçÁΩÆ
      if (!config.condition) {
        initializeCondition(config)
      }

      if (config.condition) {
        console.log('[INTERACTION-DEBUG] ËÆæÁΩÆÊù°‰ª∂Ââç:', {
          currentConditionValue: config.condition.value,
          propertyDefaultValue: property.defaultValue,
          propertyType: property.type
        })

        // Ê†πÊçÆÂ±ûÊÄßÁ±ªÂûãËÆæÁΩÆÈªòËÆ§ÁöÑÊØîËæÉÊù°‰ª∂
        switch (property.type) {
          case 'number':
            config.condition.type = 'comparison'
            config.condition.operator = 'greaterThan'
            config.condition.value = property.defaultValue || 0
            break
          case 'string':
            config.condition.type = 'comparison'
            config.condition.operator = 'equals'
            config.condition.value = property.defaultValue || ''
            break
          case 'boolean':
            config.condition.type = 'comparison'
            config.condition.operator = 'equals'
            config.condition.value = property.defaultValue || false
            break
          default:
            // ‰øùÊåÅÂΩìÂâçÈÖçÁΩÆ
            break
        }

        console.log('[INTERACTION-DEBUG] ËÆæÁΩÆÊù°‰ª∂Âêé:', {
          finalConditionValue: config.condition.value,
          conditionOperator: config.condition.operator
        })
      }

      console.log(`[INTERACTION-DEBUG] ËÆæÁΩÆÁõëÂê¨Â±ûÊÄß: ${propertyName}`, {
        propertyType: property.type,
        defaultValue: property.defaultValue,
        condition: config.condition
      })
    }
  }

  handleInteractionChange()
}

// üî• Ê∑ªÂä†‰∫§‰∫íÈÖçÁΩÆÔºàÁÆÄÂåñÁâàÔºåÂè™Êúâ dataChange ÊâçÂàùÂßãÂåñÊù°‰ª∂Ôºâ
const addInteractionConfig = () => {
  const newConfig: InteractionConfig = {
    event: 'click', // ÈªòËÆ§‰∏∫ÁÇπÂáª‰∫ã‰ª∂
    responses: [],
    enabled: true,
    priority: 1,
    name: `‰∫§‰∫íÈÖçÁΩÆ ${localInteractionConfigs.value.length + 1}`
  }

  // Âè™Êúâ dataChange ‰∫ã‰ª∂ÊâçÂàùÂßãÂåñÊù°‰ª∂
  if (newConfig.event === 'dataChange') {
    initializeCondition(newConfig)
  }

  localInteractionConfigs.value.push(newConfig)
  handleInteractionChange()
}

// Ê∑ªÂä†ÂìçÂ∫îÂä®‰ΩúÔºà‰ΩøÁî®Ê†∏ÂøÉÂä®‰ΩúÔºâ
const addResponse = (configIndex: number) => {
  console.log('[INTERACTION-DEBUG] Ê∑ªÂä†ÂìçÂ∫îÂä®‰ΩúÂºÄÂßã:', {
    configIndex,
    ÂΩìÂâçÈÖçÁΩÆ: localInteractionConfigs.value[configIndex],
    Áé∞ÊúâÂìçÂ∫îÊï∞Èáè: localInteractionConfigs.value[configIndex]?.responses?.length || 0
  })

  const newResponse: InteractionResponse = {
    action: 'navigateToUrl', // ÈªòËÆ§‰∏∫È°µÈù¢Ë∑≥ËΩ¨
    value: 'https://example.com'
  }

  console.log('[INTERACTION-DEBUG] Êñ∞Âª∫ÂìçÂ∫îÂä®‰Ωú:', newResponse)

  localInteractionConfigs.value[configIndex].responses.push(newResponse)

  console.log('[INTERACTION-DEBUG] Ê∑ªÂä†ÂêéÂìçÂ∫îÊï∞Èáè:', localInteractionConfigs.value[configIndex].responses.length)
  console.log('[INTERACTION-DEBUG] ÂÆåÊï¥ÈÖçÁΩÆ:', localInteractionConfigs.value[configIndex])

  handleInteractionChange()
}

// Âà†Èô§ÂìçÂ∫îÂä®‰Ωú
const removeResponse = (configIndex: number, responseIndex: number) => {
  localInteractionConfigs.value[configIndex].responses.splice(responseIndex, 1)
  handleInteractionChange()
}

// Â§ÑÁêÜ‰∫§‰∫íÈÖçÁΩÆÂèòÂåñ
const handleInteractionChange = () => {
  // Èò≤ÊäñÂ§ÑÁêÜÔºåÈÅøÂÖçËøáÈ¢ëÁπÅÁöÑÊõ¥Êñ∞
  nextTick(() => {
    console.log('[INTERACTION-DEBUG] ÈÖçÁΩÆÂèòÂåñ:', {
      configCount: localInteractionConfigs.value.length,
      configs: localInteractionConfigs.value.map(c => ({
        event: c.event,
        responsesCount: c.responses?.length || 0,
        responses: c.responses
      }))
    })

    emit('update:modelValue', [...localInteractionConfigs.value])
    emit('change', [...localInteractionConfigs.value])

    // È™åËØÅÈÖçÁΩÆ
    validateInteractions()
  })
}

// Â§ÑÁêÜ‰∫§‰∫íÂä®‰Ωú
const handleInteractionAction = (action: string, index: number) => {
  switch (action) {
    case 'copy':
      copyInteractionConfig(index)
      break
    case 'duplicate':
      duplicateInteractionConfig(index)
      break
    case 'advanced':
      openAdvancedSettings(index)
      break
    case 'delete':
      deleteInteractionConfig(index)
      break
  }
}

// Â§çÂà∂‰∫§‰∫íÈÖçÁΩÆ
const copyInteractionConfig = (index: number) => {
  const config = localInteractionConfigs.value[index]
  const copiedConfig: InteractionConfig = {
    ...config,
    name: `${config.name} (ÂâØÊú¨)`,
    responses: config.responses.map(r => ({ ...r }))
  }

  localInteractionConfigs.value.splice(index + 1, 0, copiedConfig)
  handleInteractionChange()
  message.success('‰∫§‰∫íÈÖçÁΩÆÂ∑≤Â§çÂà∂')
}

// Â§çÂà∂‰∏∫Ê®°Êùø
const duplicateInteractionConfig = (index: number) => {
  // TODO: ÂÆûÁé∞‰øùÂ≠ò‰∏∫Ê®°ÊùøÂäüËÉΩ
  message.info('Ê®°ÊùøÂäüËÉΩÂºÄÂèë‰∏≠...')
}

// ÊâìÂºÄÈ´òÁ∫ßËÆæÁΩÆ
const openAdvancedSettings = (index: number) => {
  // TODO: ÂÆûÁé∞È´òÁ∫ßËÆæÁΩÆÂØπËØùÊ°Ü
  message.info('È´òÁ∫ßËÆæÁΩÆÂäüËÉΩÂºÄÂèë‰∏≠...')
}

// Âà†Èô§‰∫§‰∫íÈÖçÁΩÆ
const deleteInteractionConfig = (index: number) => {
  localInteractionConfigs.value.splice(index, 1)
  handleInteractionChange()
  message.success('‰∫§‰∫íÈÖçÁΩÆÂ∑≤Âà†Èô§')
}

// Â∫îÁî®Ê®°Êùø
const applyTemplate = (template: InteractionConfig) => {
  localInteractionConfigs.value.push({
    ...template,
    name: `${template.name} (Êù•Ëá™Ê®°Êùø)`
  })
  handleInteractionChange()
  showTemplateDialog.value = false
  message.success('Ê®°ÊùøÂ∑≤Â∫îÁî®')
}

// È¢ÑËßà‰∫§‰∫í
const previewInteractions = () => {
  showPreviewDialog.value = true
}

// È™åËØÅ‰∫§‰∫íÈÖçÁΩÆ
const validateInteractions = () => {
  const errors: string[] = []

  localInteractionConfigs.value.forEach((config, index) => {
    if (!config.event) {
      errors.push(`‰∫§‰∫íÈÖçÁΩÆ ${index + 1}: Áº∫Â∞ë‰∫ã‰ª∂Á±ªÂûã`)
    }

    if (config.responses.length === 0) {
      errors.push(`‰∫§‰∫íÈÖçÁΩÆ ${index + 1}: Áº∫Â∞ëÂìçÂ∫îÂä®‰Ωú`)
    }

    config.responses.forEach((response, responseIndex) => {
      if (!response.action) {
        errors.push(`‰∫§‰∫íÈÖçÁΩÆ ${index + 1} Âä®‰Ωú ${responseIndex + 1}: Áº∫Â∞ëÂä®‰ΩúÁ±ªÂûã`)
      }

      if (response.value === undefined || response.value === null) {
        errors.push(`‰∫§‰∫íÈÖçÁΩÆ ${index + 1} Âä®‰Ωú ${responseIndex + 1}: Áº∫Â∞ëÂä®‰ΩúÂÄº`)
      }
    })
  })

  emit('validate', {
    valid: errors.length === 0,
    errors
  })
}

// ÁõëÂê¨Â§ñÈÉ®ÈÖçÁΩÆÂèòÂåñ
watch(
  () => props.modelValue,
  newValue => {
    if (newValue && JSON.stringify(newValue) !== JSON.stringify(localInteractionConfigs.value)) {
      localInteractionConfigs.value = newValue.map(config => ({ ...config }))
    }
  },
  { immediate: true, deep: true }
)

// ÁªÑ‰ª∂ÊåÇËΩΩÊó∂Ê≥®ÂÜåÂà∞‰∫§‰∫íÁÆ°ÁêÜÂô®
onMounted(() => {
  console.log('[INTERACTION-DEBUG] InteractionSettingsFormÊåÇËΩΩ:', {
    componentId: props.componentId,
    readonly: props.readonly,
    configsLength: localInteractionConfigs.value.length
  })

  if (props.componentId && localInteractionConfigs.value.length > 0) {
    interactionManager.registerComponent(props.componentId, localInteractionConfigs.value)
  }
})

// ÁõëÂê¨ÈÖçÁΩÆÂèòÂåñÔºåÂêåÊ≠•Âà∞‰∫§‰∫íÁÆ°ÁêÜÂô®
watch(
  localInteractionConfigs,
  newConfigs => {
    console.log('[INTERACTION-DEBUG] ÂêåÊ≠•ÈÖçÁΩÆÂà∞InteractionManager:', {
      componentId: props.componentId,
      configCount: newConfigs.length,
      configs: newConfigs.map(c => ({
        event: c.event,
        responsesCount: c.responses?.length || 0,
        hasResponses: c.responses && c.responses.length > 0
      }))
    })

    if (props.componentId) {
      if (newConfigs.length > 0) {
        interactionManager.updateComponentConfigs(props.componentId, newConfigs)
      } else {
        interactionManager.unregisterComponent(props.componentId, [])
      }
    }
  },
  { deep: true }
)
</script>

<style scoped>
.interaction-settings-form {
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 8px;
}

.form-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--card-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
}

.form-title {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: var(--text-color);
}

.interaction-list {
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.interaction-card {
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.interaction-card:hover {
  border-color: var(--primary-color);
  box-shadow: 0 2px 8px var(--primary-color-hover);
}

.interaction-card.disabled {
  opacity: 0.6;
  filter: grayscale(0.3);
}

.interaction-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.interaction-info {
  display: flex;
  align-items: center;
  gap: 8px;
}

.interaction-title {
  font-weight: 500;
  color: var(--text-color);
}

.interaction-actions {
  display: flex;
  align-items: center;
  gap: 8px;
}

.interaction-content {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.responses-section {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 0;
  border-bottom: 1px solid var(--border-color);
}

.section-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-color-2);
}

.no-responses {
  padding: 16px;
  text-align: center;
}

.responses-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.response-card {
  border: 1px dashed var(--border-color);
  background: var(--body-color);
  transition: all 0.2s ease;
}

.response-card:hover {
  border-color: var(--info-color);
  background: var(--info-color-suppl);
}

.response-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.empty-state {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
}

/* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
@media (max-width: 768px) {
  .form-header {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }

  .interaction-header {
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
  }

  .interaction-info {
    justify-content: center;
  }

  .interaction-actions {
    justify-content: space-between;
  }
}

/* ÊªöÂä®Êù°Ê†∑Âºè */
.interaction-list::-webkit-scrollbar {
  width: 6px;
}

.interaction-list::-webkit-scrollbar-track {
  background: var(--body-color);
  border-radius: 3px;
}

.interaction-list::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 3px;
}

.interaction-list::-webkit-scrollbar-thumb:hover {
  background: var(--text-color-3);
}

/* Âä®ÁîªÊïàÊûú */
.interaction-card {
  animation: fadeInUp 0.3s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Ë°®ÂçïÈ°πÊ†∑Âºè‰ºòÂåñ */
:deep(.n-form-item) {
  margin-bottom: 12px;
}

:deep(.n-form-item-label) {
  font-size: 12px;
  color: var(--text-color-2);
  font-weight: 500;
}

/* Âç°ÁâáÊ†∑Âºè‰ºòÂåñ */
:deep(.n-card .n-card__header) {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-color);
}

:deep(.n-card .n-card__content) {
  padding: 16px;
}

/* ÊåâÈíÆÊ†∑Âºè */
:deep(.n-button) {
  border-radius: 6px;
}

/* Ê†áÁ≠æÊ†∑Âºè */
:deep(.n-tag) {
  border-radius: 4px;
}

/* Á©∫Áä∂ÊÄÅÊ†∑Âºè */
:deep(.n-empty .n-empty__icon) {
  font-size: 48px;
  color: var(--text-color-3);
}

:deep(.n-empty .n-empty__description) {
  color: var(--text-color-2);
  margin: 12px 0;
}

/* È´òÁ∫ßÈÄâÈ°πÂàáÊç¢Ê†∑Âºè */
.advanced-options-toggle {
  display: flex;
  justify-content: center;
  padding: 8px 0;
  border-top: 1px solid var(--border-color);
  margin-top: 8px;
}

.trigger-type-label {
  display: flex;
  align-items: center;
}

/* Êù°‰ª∂ÈÖçÁΩÆÊ†∑Âºè */
.condition-config {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  padding: 8px;
  background: var(--body-color);
  border: 1px solid var(--border-color);
  border-radius: 6px;
}

.condition-config .n-select,
.condition-config .n-input {
  flex-shrink: 0;
}

.condition-config span {
  color: var(--text-color-2);
  font-weight: 500;
  font-size: 12px;
}

/* ÂìçÂ∫îÂºèÊù°‰ª∂ÈÖçÁΩÆ */
@media (max-width: 768px) {
  .condition-config {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }

  .condition-config .n-select,
  .condition-config .n-input {
    width: 100% !important;
    flex: none;
  }
}
</style>
