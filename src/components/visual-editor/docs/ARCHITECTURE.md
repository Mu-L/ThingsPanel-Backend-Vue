# Visual Editor 架构设计

## 1. 概述

Visual Editor 是一个功能强大、高度可扩展的可视化编辑器组件，旨在提供灵活的仪表板和界面构建能力。其核心设计理念是**模块化**、**可配置**和**数据驱动**。

## 2. 核心架构

Visual Editor 的架构围绕以下几个核心概念构建：

- **组件 (Components)**: 可视化编辑器的基本构建块，例如图表、表格、指示器等。
- **渲染器 (Renderers)**: 负责将组件定义渲染为实际的 DOM 元素。
- **配置 (Configuration)**: 定义组件外观、行为和数据源的元数据。
- **数据源 (Data Sources)**: 为组件提供数据的来源，例如设备遥测、API 端点或静态数据。
- **状态管理 (State Management)**: 负责管理编辑器的全局状态，例如当前选中的组件、布局信息等。

## 3. 目录结构

```
visual-editor/
├── components/      # 可视化编辑器内部使用的UI组件
├── composables/     # Vue 3 Composition API 可组合函数
├── configuration/   # 组件配置相关的定义和工具
├── core/            # 核心逻辑，包括配置发现、API管理等
├── docs/            # 文档
├── hooks/           # React-style hooks
├── renderers/       # 组件渲染器
├── store/           # 状态管理 (Pinia)
├── theme/           # 主题和样式
├── types/           # TypeScript 类型定义
├── utils/           # 工具函数
└── widgets/         # 可重用的预配置组件
```

## 4. 关键模块详解

### 4.1. `core` 模块

`core` 模块是编辑器的核心，包含了几个关键子系统：

- **`ConfigDiscovery.ts`**: 自动发现和注册配置组件，支持多种格式和来源。它使用缓存和并行扫描来优化性能。
- **`component-api-config.ts`**: 根据组件类型自动配置数据源 API。这使得组件开发者可以专注于组件逻辑，而无需关心数据绑定的细节。
- **`component-data-requirements.ts`**: 提供了一个标准化的方式来声明组件的数据需求。这使得编辑器可以动态地为组件提供正确的数据源配置选项。

### 4.2. `renderers` 模块

渲染器负责将组件的配置和数据转换为可视化的界面。每个组件类型都可以有自己的渲染器，从而实现高度定制化的外观和行为。

### 4.3. `widgets` 模块

小组件是预先配置好的组件，可以被用户直接拖放到画布上。它们封装了常见的用例，并简化了编辑器的使用。

## 5. 数据流

1.  **配置加载**: 编辑器启动时，`ConfigDiscovery` 会扫描并加载所有可用的组件配置。
2.  **组件渲染**: 用户将一个小组件拖放到画布上时，相应的渲染器会根据其配置和数据源来渲染组件。
3.  **数据绑定**: `component-api-config` 会根据组件的类型和数据需求，自动为其配置合适的数据源 API。
4.  **状态更新**: 用户的操作（例如移动、调整大小、修改配置）会更新编辑器的全局状态，从而触发界面的重新渲染。

## 6. 扩展性

Visual Editor 的设计充分考虑了扩展性。开发者可以通过以下方式来扩展编辑器：

- **创建新的组件**: 开发新的 Vue 组件，并为其提供相应的配置。
- **创建新的渲染器**: 为现有组件创建新的渲染器，以实现不同的外观或行为。
- **创建新的小组件**: 将常用的组件配置封装为小组件，以简化编辑器的使用。