# 数据映射功能测试

## 问题分析

用户反馈：数据选择后组件没有变化

## 可能的原因

1. **数据映射配置没有正确传递**
2. **组件没有正确使用映射后的数据**
3. **数据源管理器没有处理映射逻辑**

## 数据流程分析

### 1. 数据源配置流程
```
DeviceDataSourceConfig.vue 
  ↓ (配置数据源)
DataMappingConfig.vue 
  ↓ (配置映射)
Card2Wrapper.vue 
  ↓ (传递数据源)
DigitIndicatorCard.vue 
  ↓ (使用映射数据)
```

### 2. 数据映射流程
```
原始数据 → DataMappingConfig → 映射配置 → DataSourceManager.transformData → 映射后数据 → 组件显示
```

## 测试步骤

### 步骤1：验证数据源配置
1. 进入可视化编辑器
2. 添加数字指示器组件
3. 打开组件设置面板
4. 配置数据源：
   - 选择设备数据源
   - 选择设备
   - 选择指标
   - 验证数据预览是否显示

### 步骤2：验证数据映射
1. 在数据映射配置中：
   - 查看数据源字段列表
   - 点击字段进行映射
   - 使用智能映射功能
   - 验证映射预览是否正确

### 步骤3：验证组件更新
1. 配置映射后：
   - 检查组件是否实时更新
   - 查看控制台日志
   - 验证数据是否正确显示

## 调试信息

### 控制台日志检查
- `🔧 DigitIndicatorCard - 订阅数据源:` - 确认数据源订阅
- `🔧 DigitIndicatorCard - 收到数据源更新:` - 确认数据更新
- 映射配置日志 - 确认映射正确

### 数据检查点
1. **数据源配置**: `props.metadata?.dataSource`
2. **映射配置**: `dataSource.dataPaths`
3. **原始数据**: `value.rawData`
4. **映射后数据**: `value.values`

## 预期结果

- 数据源配置正确传递
- 映射配置正确应用
- 组件实时更新显示
- 控制台无错误信息

## 修复方案

如果发现问题，可能的修复点：

1. **数据源传递**: 确保 `Card2Wrapper` 正确传递数据源
2. **映射处理**: 确保 `DataSourceManager.transformData` 正确处理映射
3. **组件更新**: 确保组件正确使用映射后的数据 