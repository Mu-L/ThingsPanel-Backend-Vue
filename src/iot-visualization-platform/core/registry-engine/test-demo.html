<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registry Engine ÊµãËØïÊºîÁ§∫</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            margin: 15px 0 0 0;
            opacity: 0.9;
            font-size: 1.2em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            min-height: 700px;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 25px;
            border-right: 1px solid #e0e0e0;
        }

        .content {
            padding: 25px;
        }

        .demo-section {
            margin-bottom: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .demo-header {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .demo-body {
            padding: 20px;
        }

        .demo-button {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s;
            font-size: 14px;
            min-width: 120px;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }

        .demo-button:active {
            transform: translateY(0);
        }

        .demo-button.success {
            background: linear-gradient(45deg, #27ae60, #229954);
        }

        .demo-button.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .demo-button.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .demo-button.info {
            background: linear-gradient(45deg, #8e44ad, #7d3c98);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .log-container {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            margin-top: 20px;
            border: 2px solid #333;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid #333;
            animation: fadeIn 0.3s ease-in;
        }

        .log-time {
            color: #888;
            margin-right: 12px;
            font-size: 11px;
        }

        .log-level-info { color: #00ff00; }
        .log-level-warn { color: #ffff00; }
        .log-level-error { color: #ff4444; }
        .log-level-success { color: #00ffaa; }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.2);
        }

        .input-group textarea {
            height: 100px;
            resize: vertical;
            font-family: 'Consolas', monospace;
        }

        .result-display {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .result-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .result-content {
            font-family: 'Consolas', monospace;
            font-size: 12px;
            color: #555;
            white-space: pre-wrap;
        }

        .clear-button {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            float: right;
            margin-bottom: 10px;
        }

        .performance-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .performance-excellent { background: #27ae60; }
        .performance-good { background: #f39c12; }
        .performance-poor { background: #e74c3c; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .pulsing {
            animation: pulse 1.5s infinite;
        }

        .accordion {
            margin-top: 20px;
        }

        .accordion-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .accordion-header {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion-header:hover {
            background: #e9ecef;
        }

        .accordion-content {
            display: none;
            padding: 15px;
            background: white;
        }

        .accordion-content.active {
            display: block;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Registry Engine ÊµãËØïÊºîÁ§∫</h1>
            <p>ThingsPanel Áâ©ËÅîÁΩëÂèØËßÜÂåñÂπ≥Âè∞ - Áªü‰∏ÄÊ≥®ÂÜåÁÆ°ÁêÜÁ≥ªÁªüÊºîÁ§∫</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>üìä ÂÆûÊó∂ÁªüËÆ°</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalItems">0</div>
                        <div class="stat-label">ÊÄªÊ≥®ÂÜåÈ°π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="enabledItems">0</div>
                        <div class="stat-label">ÂêØÁî®È°πÁõÆ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="itemTypes">0</div>
                        <div class="stat-label">È°πÁõÆÁ±ªÂûã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="performance">-</div>
                        <div class="stat-label">ÊÄßËÉΩÊåáÊ†á</div>
                    </div>
                </div>

                <h3>üéõÔ∏è ÊéßÂà∂Èù¢Êùø</h3>
                <button class="demo-button success" onclick="initializeDemo()">ÂàùÂßãÂåñÊºîÁ§∫</button>
                <button class="demo-button info" onclick="runPerformanceTest()">ÊÄßËÉΩÊµãËØï</button>
                <button class="demo-button warning" onclick="runErrorTest()">ÈîôËØØÊµãËØï</button>
                <button class="demo-button danger" onclick="clearAllData()">Ê∏ÖÁ©∫Êï∞ÊçÆ</button>
                <button class="clear-button" onclick="clearLogs()">Ê∏ÖÁ©∫Êó•Âøó</button>

                <h3>üìã Á±ªÂûãÂàÜÂ∏É</h3>
                <div id="typeDistribution"></div>

                <h3>üè∑Ô∏è ÂàÜÁ±ªÁªüËÆ°</h3>
                <div id="categoryStats"></div>
            </div>

            <div class="content">
                <div class="demo-section">
                    <div class="demo-header">
                        <span>üéØ Âü∫Á°ÄÊ≥®ÂÜåÊìç‰Ωú</span>
                    </div>
                    <div class="demo-body">
                        <p>ÊºîÁ§∫Registry EngineÁöÑÂü∫Êú¨Ê≥®ÂÜåÂíåÊü•ËØ¢ÂäüËÉΩ</p>
                        <button class="demo-button" onclick="registerBasicComponent()">Ê≥®ÂÜåÂü∫Á°ÄÁªÑ‰ª∂</button>
                        <button class="demo-button" onclick="registerWithDependencies()">Ê≥®ÂÜå‰æùËµñÁªÑ‰ª∂</button>
                        <button class="demo-button" onclick="queryComponents()">Êü•ËØ¢ÁªÑ‰ª∂</button>
                        <button class="demo-button" onclick="testValidation()">È™åËØÅÊµãËØï</button>
                    </div>
                </div>

                <div class="demo-section">
                    <div class="demo-header">
                        <span>üì¶ ÊâπÈáèÊìç‰ΩúÊºîÁ§∫</span>
                    </div>
                    <div class="demo-body">
                        <p>ÊºîÁ§∫Â§ßÈáèÁªÑ‰ª∂ÁöÑÊâπÈáèÊ≥®ÂÜåÂíåÁÆ°ÁêÜ</p>
                        <div class="input-group">
                            <label for="batchCount">ÊâπÈáèÊ≥®ÂÜåÊï∞Èáè:</label>
                            <input type="number" id="batchCount" value="50" min="1" max="500">
                        </div>
                        <button class="demo-button" onclick="batchRegisterComponents()">ÊâπÈáèÊ≥®ÂÜå</button>
                        <button class="demo-button" onclick="batchQueryComponents()">ÊâπÈáèÊü•ËØ¢</button>
                        <button class="demo-button" onclick="complexQuery()">Â§çÊùÇÊü•ËØ¢</button>
                    </div>
                </div>

                <div class="demo-section">
                    <div class="demo-header">
                        <span>üîó ‰æùËµñÂÖ≥Á≥ªÁÆ°ÁêÜ</span>
                    </div>
                    <div class="demo-body">
                        <p>ÊºîÁ§∫ÁªÑ‰ª∂‰æùËµñÂÖ≥Á≥ªÁöÑÂª∫Á´ãÂíåÈ™åËØÅ</p>
                        <button class="demo-button" onclick="createDependencyChain()">ÂàõÂª∫‰æùËµñÈìæ</button>
                        <button class="demo-button" onclick="validateDependencies()">È™åËØÅ‰æùËµñ</button>
                        <button class="demo-button" onclick="analyzeDependencies()">‰æùËµñÂàÜÊûê</button>
                        <button class="demo-button" onclick="testCircularDependency()">Âæ™ÁéØ‰æùËµñÊµãËØï</button>
                    </div>
                </div>

                <div class="demo-section">
                    <div class="demo-header">
                        <span>üõ†Ô∏è Ëá™ÂÆö‰πâÁªÑ‰ª∂ÊµãËØï</span>
                    </div>
                    <div class="demo-body">
                        <div class="input-group">
                            <label for="customId">ÁªÑ‰ª∂ID:</label>
                            <input type="text" id="customId" placeholder="‰æã: my-weather-widget" value="my-weather-widget">
                        </div>
                        <div class="input-group">
                            <label for="customName">ÁªÑ‰ª∂ÂêçÁß∞:</label>
                            <input type="text" id="customName" placeholder="‰æã: Â§©Ê∞îÁªÑ‰ª∂" value="Â§©Ê∞îÁªÑ‰ª∂">
                        </div>
                        <div class="input-group">
                            <label for="customType">ÁªÑ‰ª∂Á±ªÂûã:</label>
                            <select id="customType">
                                <option value="card21-component">Card2.1ÁªÑ‰ª∂</option>
                                <option value="legacy-card-component">‰º†ÁªüCardÁªÑ‰ª∂</option>
                                <option value="visual-editor-component">ÂèØËßÜÂåñÁºñËæëÂô®ÁªÑ‰ª∂</option>
                                <option value="renderer">Ê∏≤ÊüìÂô®</option>
                                <option value="data-source">Êï∞ÊçÆÊ∫ê</option>
                                <option value="template">Ê®°Êùø</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="customContent">ÁªÑ‰ª∂ÂÜÖÂÆπ (JSON):</label>
                            <textarea id="customContent" placeholder='{"type": "weather-widget", "config": {}}'>{
  "type": "weather-widget",
  "dataSources": [
    {
      "key": "weather",
      "type": "api",
      "url": "/api/weather"
    }
  ],
  "staticParams": {
    "refreshInterval": 300000,
    "showForecast": true
  }
}</textarea>
                        </div>
                        <button class="demo-button" onclick="registerCustomComponent()">Ê≥®ÂÜåËá™ÂÆö‰πâÁªÑ‰ª∂</button>
                        <button class="demo-button" onclick="queryCustomComponent()">Êü•ËØ¢Ëá™ÂÆö‰πâÁªÑ‰ª∂</button>
                    </div>
                </div>

                <div class="demo-section">
                    <div class="demo-header">
                        <span>üìà ÁªìÊûúÂ±ïÁ§∫</span>
                    </div>
                    <div class="demo-body">
                        <div class="result-display" id="resultDisplay"></div>
                    </div>
                </div>

                <div class="log-container" id="logContainer">
                    <div class="log-entry">
                        <span class="log-time">[Á≥ªÁªü]</span>
                        <span class="log-level-info">Registry Engine ÊºîÁ§∫Á≥ªÁªüÂ∑≤ÂêØÂä®</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ê®°ÊãüRegistry EngineÂäüËÉΩ
        class DemoRegistryEngine {
            constructor() {
                this.items = new Map()
                this.typeIndex = new Map()
                this.categoryIndex = new Map()
                this.tagIndex = new Map()
                this.dependencyGraph = new Map()
                this.reverseDependencyGraph = new Map()
                this.performanceData = []
                this.eventListeners = new Map()
            }

            async register(item) {
                const startTime = performance.now()

                try {
                    // È™åËØÅÂøÖÈúÄÂ≠óÊÆµ
                    if (!item.metadata.id || !item.metadata.name || !item.metadata.type) {
                        throw new Error('Áº∫Â∞ëÂøÖÈúÄÁöÑÂÖÉÊï∞ÊçÆÂ≠óÊÆµ')
                    }

                    // Ê£ÄÊü•IDÂîØ‰∏ÄÊÄß
                    if (this.items.has(item.metadata.id)) {
                        throw new Error(`È°πÁõÆ ${item.metadata.id} Â∑≤Â≠òÂú®`)
                    }

                    // ÊâßË°åÈ™åËØÅ
                    if (item.validate && !await item.validate()) {
                        throw new Error('È°πÁõÆÈ™åËØÅÂ§±Ë¥•')
                    }

                    // Â≠òÂÇ®È°πÁõÆ
                    this.items.set(item.metadata.id, item)

                    // Êõ¥Êñ∞Á¥¢Âºï
                    this.updateIndexes(item.metadata, 'add')

                    // ÊâßË°åÂàùÂßãÂåñ
                    if (item.initialize) {
                        await item.initialize()
                    }

                    const duration = performance.now() - startTime
                    this.performanceData.push(duration)
                    if (this.performanceData.length > 100) {
                        this.performanceData.shift()
                    }

                    this.emit('register', item.metadata)

                    logMessage(`‚úÖ ÊàêÂäüÊ≥®ÂÜå: ${item.metadata.type}/${item.metadata.id}`, 'success')
                    return true

                } catch (error) {
                    logMessage(`‚ùå Ê≥®ÂÜåÂ§±Ë¥•: ${error.message}`, 'error')
                    this.emit('error', { action: 'register', error, metadata: item.metadata })
                    return false
                }
            }

            async unregister(id) {
                try {
                    const item = this.items.get(id)
                    if (!item) {
                        logMessage(`‚ö†Ô∏è È°πÁõÆ ${id} ‰∏çÂ≠òÂú®`, 'warn')
                        return false
                    }

                    // ÊâßË°åÊ∏ÖÁêÜ
                    if (item.cleanup) {
                        await item.cleanup()
                    }

                    // Êõ¥Êñ∞Á¥¢Âºï
                    this.updateIndexes(item.metadata, 'remove')

                    // Âà†Èô§È°πÁõÆ
                    this.items.delete(id)

                    this.emit('unregister', id)
                    logMessage(`üóëÔ∏è ÊàêÂäüÊ≥®ÈîÄ: ${id}`, 'info')
                    return true

                } catch (error) {
                    logMessage(`‚ùå Ê≥®ÈîÄÂ§±Ë¥•: ${error.message}`, 'error')
                    return false
                }
            }

            get(id) {
                return this.items.get(id) || null
            }

            has(id) {
                return this.items.has(id)
            }

            query(conditions = {}) {
                let results = Array.from(this.items.values())

                if (conditions.type) {
                    const types = Array.isArray(conditions.type) ? conditions.type : [conditions.type]
                    results = results.filter(item => types.includes(item.metadata.type))
                }

                if (conditions.enabled !== undefined) {
                    results = results.filter(item => item.metadata.enabled === conditions.enabled)
                }

                if (conditions.category) {
                    results = results.filter(item => item.metadata.category === conditions.category)
                }

                if (conditions.tags) {
                    results = results.filter(item => {
                        if (!item.metadata.tags) return false
                        return conditions.tags.every(tag => item.metadata.tags.includes(tag))
                    })
                }

                if (conditions.filter) {
                    results = results.filter(conditions.filter)
                }

                return results
            }

            getByType(type) {
                const ids = this.typeIndex.get(type)
                if (!ids) return []
                return Array.from(ids).map(id => this.items.get(id)).filter(Boolean)
            }

            getByCategory(category) {
                const ids = this.categoryIndex.get(category)
                if (!ids) return []
                return Array.from(ids).map(id => this.items.get(id)).filter(Boolean)
            }

            getByTag(tag) {
                const ids = this.tagIndex.get(tag)
                if (!ids) return []
                return Array.from(ids).map(id => this.items.get(id)).filter(Boolean)
            }

            getDependencies(id, recursive = false) {
                const direct = this.dependencyGraph.get(id)
                if (!direct) return []

                if (!recursive) {
                    return Array.from(direct)
                }

                const allDeps = new Set()
                const visited = new Set()

                const collectDeps = (itemId) => {
                    if (visited.has(itemId)) return
                    visited.add(itemId)

                    const deps = this.dependencyGraph.get(itemId)
                    if (deps) {
                        for (const dep of deps) {
                            allDeps.add(dep)
                            collectDeps(dep)
                        }
                    }
                }

                collectDeps(id)
                return Array.from(allDeps)
            }

            getDependents(id, recursive = false) {
                const direct = this.reverseDependencyGraph.get(id)
                if (!direct) return []

                if (!recursive) {
                    return Array.from(direct)
                }

                const allDependents = new Set()
                const visited = new Set()

                const collectDependents = (itemId) => {
                    if (visited.has(itemId)) return
                    visited.add(itemId)

                    const dependents = this.reverseDependencyGraph.get(itemId)
                    if (dependents) {
                        for (const dependent of dependents) {
                            allDependents.add(dependent)
                            collectDependents(dependent)
                        }
                    }
                }

                collectDependents(id)
                return Array.from(allDependents)
            }

            getStats() {
                const items = Array.from(this.items.values())
                const byType = {}
                const byCategory = {}
                let enabled = 0
                let withDependencies = 0
                let lastUpdated = 0

                for (const item of items) {
                    const { metadata } = item

                    byType[metadata.type] = (byType[metadata.type] || 0) + 1

                    if (metadata.category) {
                        byCategory[metadata.category] = (byCategory[metadata.category] || 0) + 1
                    }

                    if (metadata.enabled) enabled++
                    if (metadata.dependencies && metadata.dependencies.length > 0) withDependencies++
                    if (metadata.updatedAt > lastUpdated) lastUpdated = metadata.updatedAt
                }

                return {
                    total: items.length,
                    byType,
                    byCategory,
                    enabled,
                    disabled: items.length - enabled,
                    withDependencies,
                    lastUpdated
                }
            }

            getAll() {
                return Array.from(this.items.values())
            }

            async clear() {
                const items = Array.from(this.items.values())
                for (const item of items) {
                    await this.unregister(item.metadata.id)
                }

                this.items.clear()
                this.typeIndex.clear()
                this.categoryIndex.clear()
                this.tagIndex.clear()
                this.dependencyGraph.clear()
                this.reverseDependencyGraph.clear()

                this.emit('clear')
                logMessage('üßπ Â∑≤Ê∏ÖÁ©∫ÊâÄÊúâÊ≥®ÂÜåÈ°π', 'info')
            }

            getAveragePerformance() {
                if (this.performanceData.length === 0) return 0
                return this.performanceData.reduce((a, b) => a + b, 0) / this.performanceData.length
            }

            updateIndexes(metadata, action) {
                const { id, type, category, tags, dependencies } = metadata

                // Á±ªÂûãÁ¥¢Âºï
                if (action === 'add') {
                    if (!this.typeIndex.has(type)) {
                        this.typeIndex.set(type, new Set())
                    }
                    this.typeIndex.get(type).add(id)
                } else {
                    const typeSet = this.typeIndex.get(type)
                    if (typeSet) {
                        typeSet.delete(id)
                        if (typeSet.size === 0) {
                            this.typeIndex.delete(type)
                        }
                    }
                }

                // ÂàÜÁ±ªÁ¥¢Âºï
                if (category) {
                    if (action === 'add') {
                        if (!this.categoryIndex.has(category)) {
                            this.categoryIndex.set(category, new Set())
                        }
                        this.categoryIndex.get(category).add(id)
                    } else {
                        const categorySet = this.categoryIndex.get(category)
                        if (categorySet) {
                            categorySet.delete(id)
                            if (categorySet.size === 0) {
                                this.categoryIndex.delete(category)
                            }
                        }
                    }
                }

                // Ê†áÁ≠æÁ¥¢Âºï
                if (tags) {
                    for (const tag of tags) {
                        if (action === 'add') {
                            if (!this.tagIndex.has(tag)) {
                                this.tagIndex.set(tag, new Set())
                            }
                            this.tagIndex.get(tag).add(id)
                        } else {
                            const tagSet = this.tagIndex.get(tag)
                            if (tagSet) {
                                tagSet.delete(id)
                                if (tagSet.size === 0) {
                                    this.tagIndex.delete(tag)
                                }
                            }
                        }
                    }
                }

                // ‰æùËµñÂÖ≥Á≥ª
                if (dependencies && dependencies.length > 0) {
                    if (action === 'add') {
                        this.dependencyGraph.set(id, new Set(dependencies))
                        for (const depId of dependencies) {
                            if (!this.reverseDependencyGraph.has(depId)) {
                                this.reverseDependencyGraph.set(depId, new Set())
                            }
                            this.reverseDependencyGraph.get(depId).add(id)
                        }
                    } else {
                        this.dependencyGraph.delete(id)
                        for (const depId of dependencies) {
                            const reverseSet = this.reverseDependencyGraph.get(depId)
                            if (reverseSet) {
                                reverseSet.delete(id)
                                if (reverseSet.size === 0) {
                                    this.reverseDependencyGraph.delete(depId)
                                }
                            }
                        }
                    }
                }
            }

            on(event, handler) {
                if (!this.eventListeners.has(event)) {
                    this.eventListeners.set(event, new Set())
                }
                this.eventListeners.get(event).add(handler)

                return () => {
                    const handlers = this.eventListeners.get(event)
                    if (handlers) {
                        handlers.delete(handler)
                        if (handlers.size === 0) {
                            this.eventListeners.delete(event)
                        }
                    }
                }
            }

            emit(event, data) {
                const handlers = this.eventListeners.get(event)
                if (handlers) {
                    for (const handler of handlers) {
                        try {
                            handler(data)
                        } catch (error) {
                            console.error('Event handler error:', error)
                        }
                    }
                }
            }
        }

        // ÂàõÂª∫ÊºîÁ§∫ÂÆû‰æã
        const registryEngine = new DemoRegistryEngine()

        // Êó•ÂøóÁ≥ªÁªü
        function logMessage(message, level = 'info', data = null) {
            const logContainer = document.getElementById('logContainer')
            const logEntry = document.createElement('div')
            logEntry.className = 'log-entry'

            const now = new Date()
            const timeStr = now.toLocaleTimeString()

            let logHtml = `<span class="log-time">[${timeStr}]</span>`
            logHtml += `<span class="log-level-${level}">${message}</span>`

            if (data && typeof data === 'object') {
                logHtml += `<br><span style="color: #888; font-size: 11px; margin-left: 60px;">Êï∞ÊçÆ: ${JSON.stringify(data, null, 2)}</span>`
            }

            logEntry.innerHTML = logHtml
            logContainer.appendChild(logEntry)
            logContainer.scrollTop = logContainer.scrollHeight

            // ÈôêÂà∂Êó•ÂøóÊù°Êï∞
            while (logContainer.children.length > 150) {
                logContainer.removeChild(logContainer.firstChild)
            }

            // Ê∑ªÂä†È´ò‰∫ÆÊïàÊûú
            logEntry.classList.add('pulsing')
            setTimeout(() => {
                logEntry.classList.remove('pulsing')
            }, 1500)
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = ''
            logMessage('Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫', 'info')
        }

        // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        function updateStats() {
            const stats = registryEngine.getStats()
            const avgPerformance = registryEngine.getAveragePerformance()

            document.getElementById('totalItems').textContent = stats.total
            document.getElementById('enabledItems').textContent = stats.enabled
            document.getElementById('itemTypes').textContent = Object.keys(stats.byType).length

            const perfElement = document.getElementById('performance')
            if (avgPerformance > 0) {
                perfElement.textContent = avgPerformance.toFixed(2) + 'ms'

                // ÊÄßËÉΩÊåáÁ§∫Âô®
                perfElement.className = 'stat-value'
                if (avgPerformance < 1) {
                    perfElement.innerHTML += '<span class="performance-indicator performance-excellent"></span>'
                } else if (avgPerformance < 5) {
                    perfElement.innerHTML += '<span class="performance-indicator performance-good"></span>'
                } else {
                    perfElement.innerHTML += '<span class="performance-indicator performance-poor"></span>'
                }
            }

            // Êõ¥Êñ∞Á±ªÂûãÂàÜÂ∏É
            const typeDistribution = document.getElementById('typeDistribution')
            typeDistribution.innerHTML = ''
            for (const [type, count] of Object.entries(stats.byType)) {
                const item = document.createElement('div')
                item.style.cssText = 'padding: 5px; margin: 2px 0; background: #e9ecef; border-radius: 3px; font-size: 12px;'
                item.textContent = `${type}: ${count}`
                typeDistribution.appendChild(item)
            }

            // Êõ¥Êñ∞ÂàÜÁ±ªÁªüËÆ°
            const categoryStats = document.getElementById('categoryStats')
            categoryStats.innerHTML = ''
            for (const [category, count] of Object.entries(stats.byCategory)) {
                const item = document.createElement('div')
                item.style.cssText = 'padding: 5px; margin: 2px 0; background: #d1ecf1; border-radius: 3px; font-size: 12px;'
                item.textContent = `${category}: ${count}`
                categoryStats.appendChild(item)
            }
        }

        // ÊòæÁ§∫ÁªìÊûú
        function displayResult(title, content) {
            const resultDisplay = document.getElementById('resultDisplay')

            const resultItem = document.createElement('div')
            resultItem.className = 'result-item'

            const titleElement = document.createElement('div')
            titleElement.className = 'result-title'
            titleElement.textContent = title

            const contentElement = document.createElement('div')
            contentElement.className = 'result-content'
            contentElement.textContent = typeof content === 'string' ? content : JSON.stringify(content, null, 2)

            resultItem.appendChild(titleElement)
            resultItem.appendChild(contentElement)
            resultDisplay.appendChild(resultItem)

            // ÈôêÂà∂ÊòæÁ§∫Êù°Êï∞
            while (resultDisplay.children.length > 10) {
                resultDisplay.removeChild(resultDisplay.firstChild)
            }
        }

        // ÊºîÁ§∫ÂáΩÊï∞
        async function initializeDemo() {
            logMessage('üöÄ ÂàùÂßãÂåñÊºîÁ§∫Êï∞ÊçÆ...', 'info')

            // Ê≥®ÂÜå‰∏Ä‰∫õÂü∫Á°ÄÁªÑ‰ª∂
            const basicComponents = [
                {
                    metadata: {
                        id: 'temperature-sensor',
                        name: 'Ê∏©Â∫¶‰º†ÊÑüÂô®',
                        type: 'card21-component',
                        version: '1.0.0',
                        description: 'Áî®‰∫éÊòæÁ§∫Ê∏©Â∫¶Êï∞ÊçÆÁöÑ‰º†ÊÑüÂô®ÁªÑ‰ª∂',
                        category: 'sensors',
                        tags: ['sensor', 'temperature', 'iot'],
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 10
                    },
                    content: {
                        type: 'temperature-sensor',
                        dataSources: [{ key: 'temp', type: 'device' }]
                    }
                },
                {
                    metadata: {
                        id: 'humidity-sensor',
                        name: 'ÊπøÂ∫¶‰º†ÊÑüÂô®',
                        type: 'card21-component',
                        version: '1.0.0',
                        category: 'sensors',
                        tags: ['sensor', 'humidity', 'iot'],
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 10
                    },
                    content: {
                        type: 'humidity-sensor',
                        dataSources: [{ key: 'humidity', type: 'device' }]
                    }
                },
                {
                    metadata: {
                        id: 'chart-renderer',
                        name: 'ÂõæË°®Ê∏≤ÊüìÂô®',
                        type: 'renderer',
                        version: '2.0.0',
                        category: 'visualization',
                        tags: ['chart', 'renderer', 'visualization'],
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 20
                    },
                    content: {
                        type: 'chart-renderer',
                        supportedCharts: ['line', 'bar', 'pie']
                    }
                }
            ]

            for (const component of basicComponents) {
                await registryEngine.register(component)
            }

            updateStats()
            logMessage('‚úÖ ÊºîÁ§∫Êï∞ÊçÆÂàùÂßãÂåñÂÆåÊàê', 'success')
        }

        async function registerBasicComponent() {
            const component = {
                metadata: {
                    id: 'demo-component-' + Date.now(),
                    name: 'ÊºîÁ§∫ÁªÑ‰ª∂',
                    type: 'card21-component',
                    version: '1.0.0',
                    description: 'ËøôÊòØ‰∏Ä‰∏™ÊºîÁ§∫Áî®ÁöÑÂü∫Á°ÄÁªÑ‰ª∂',
                    category: 'demo',
                    tags: ['demo', 'test'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 5
                },
                content: {
                    type: 'demo-component',
                    config: { demo: true }
                },
                validate: () => {
                    logMessage('üîç ÊâßË°åÁªÑ‰ª∂È™åËØÅ...', 'info')
                    return true
                },
                initialize: async () => {
                    logMessage('üöÄ ÊâßË°åÁªÑ‰ª∂ÂàùÂßãÂåñ...', 'info')
                }
            }

            const success = await registryEngine.register(component)
            updateStats()

            if (success) {
                displayResult('Âü∫Á°ÄÁªÑ‰ª∂Ê≥®ÂÜå', component.metadata)
            }
        }

        async function registerWithDependencies() {
            // ÂÖàÊ≥®ÂÜå‰æùËµñÁªÑ‰ª∂
            const dependency = {
                metadata: {
                    id: 'data-service',
                    name: 'Êï∞ÊçÆÊúçÂä°',
                    type: 'data-source',
                    version: '1.0.0',
                    category: 'service',
                    tags: ['service', 'data'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 100
                },
                content: { type: 'data-service' }
            }

            await registryEngine.register(dependency)

            // Ê≥®ÂÜåÊúâ‰æùËµñÁöÑÁªÑ‰ª∂
            const dependentComponent = {
                metadata: {
                    id: 'chart-with-data',
                    name: 'Êï∞ÊçÆÂõæË°®',
                    type: 'card21-component',
                    version: '1.0.0',
                    category: 'visualization',
                    tags: ['chart', 'data'],
                    dependencies: ['data-service'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 50
                },
                content: {
                    type: 'chart-with-data',
                    dataSources: [{ key: 'chartData', service: 'data-service' }]
                }
            }

            const success = await registryEngine.register(dependentComponent)
            updateStats()

            if (success) {
                displayResult('‰æùËµñÁªÑ‰ª∂Ê≥®ÂÜå', {
                    component: dependentComponent.metadata,
                    dependencies: registryEngine.getDependencies('chart-with-data')
                })
            }
        }

        function queryComponents() {
            const sensorComponents = registryEngine.query({
                type: 'card21-component',
                tags: ['sensor']
            })

            const allComponents = registryEngine.getAll()

            displayResult('ÁªÑ‰ª∂Êü•ËØ¢ÁªìÊûú', {
                ‰º†ÊÑüÂô®ÁªÑ‰ª∂Êï∞Èáè: sensorComponents.length,
                ÊÄªÁªÑ‰ª∂Êï∞: allComponents.length,
                ‰º†ÊÑüÂô®ÁªÑ‰ª∂: sensorComponents.map(c => c.metadata.name)
            })

            logMessage(`üìä Êü•ËØ¢ÂÆåÊàê: ÊâæÂà∞ ${sensorComponents.length} ‰∏™‰º†ÊÑüÂô®ÁªÑ‰ª∂`, 'info')
        }

        async function testValidation() {
            // ÊµãËØïÈ™åËØÅÂ§±Ë¥•ÁöÑÁªÑ‰ª∂
            const invalidComponent = {
                metadata: {
                    id: 'invalid-component',
                    name: '',  // Á©∫ÂêçÁß∞
                    type: 'card21-component',
                    version: '',
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 0
                },
                content: {},
                validate: () => {
                    logMessage('‚ùå ÁªÑ‰ª∂È™åËØÅÂ§±Ë¥•', 'error')
                    return false
                }
            }

            const result = await registryEngine.register(invalidComponent)
            updateStats()

            displayResult('È™åËØÅÊµãËØïÁªìÊûú', {
                Ê≥®ÂÜåÁªìÊûú: result ? 'ÊàêÂäü' : 'Â§±Ë¥•ÔºàÈ¢ÑÊúüÔºâ',
                È™åËØÅÂäüËÉΩ: 'Ê≠£Â∏∏Â∑•‰Ωú'
            })
        }

        async function batchRegisterComponents() {
            const count = parseInt(document.getElementById('batchCount').value) || 50
            logMessage(`üì¶ ÂºÄÂßãÊâπÈáèÊ≥®ÂÜå ${count} ‰∏™ÁªÑ‰ª∂...`, 'info')

            const startTime = performance.now()
            const promises = []

            for (let i = 0; i < count; i++) {
                const component = {
                    metadata: {
                        id: `batch-component-${i}`,
                        name: `ÊâπÈáèÁªÑ‰ª∂ ${i}`,
                        type: 'card21-component',
                        version: '1.0.0',
                        category: i % 3 === 0 ? 'sensors' : i % 3 === 1 ? 'controls' : 'displays',
                        tags: ['batch', 'test', `group-${Math.floor(i / 10)}`],
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: Math.random() > 0.1,
                        priority: Math.floor(Math.random() * 100)
                    },
                    content: {
                        type: `batch-component-${i}`,
                        index: i,
                        data: Math.random() * 100
                    }
                }

                promises.push(registryEngine.register(component))
            }

            const results = await Promise.all(promises)
            const duration = performance.now() - startTime
            const successCount = results.filter(r => r).length

            updateStats()

            displayResult('ÊâπÈáèÊ≥®ÂÜåÁªìÊûú', {
                ÊÄªÊï∞: count,
                ÊàêÂäü: successCount,
                Â§±Ë¥•: count - successCount,
                ËÄóÊó∂: `${duration.toFixed(2)}ms`,
                Âπ≥ÂùáËÄóÊó∂: `${(duration / count).toFixed(2)}ms/‰∏™`
            })

            logMessage(`‚úÖ ÊâπÈáèÊ≥®ÂÜåÂÆåÊàê: ${successCount}/${count} ÊàêÂäü`, 'success')
        }

        function batchQueryComponents() {
            const startTime = performance.now()

            const sensorComponents = registryEngine.query({
                category: 'sensors',
                enabled: true
            })

            const batchComponents = registryEngine.query({
                tags: ['batch']
            })

            const duration = performance.now() - startTime

            displayResult('ÊâπÈáèÊü•ËØ¢ÁªìÊûú', {
                ‰º†ÊÑüÂô®ÁªÑ‰ª∂: sensorComponents.length,
                ÊâπÈáèÁªÑ‰ª∂: batchComponents.length,
                Êü•ËØ¢ËÄóÊó∂: `${duration.toFixed(2)}ms`
            })

            logMessage(`üîç ÊâπÈáèÊü•ËØ¢ÂÆåÊàêÔºåËÄóÊó∂ ${duration.toFixed(2)}ms`, 'info')
        }

        function complexQuery() {
            const startTime = performance.now()

            const complexResults = registryEngine.query({
                type: 'card21-component',
                enabled: true,
                filter: (item) => {
                    return item.metadata.priority > 20 &&
                           item.metadata.tags &&
                           item.metadata.tags.length >= 2 &&
                           item.metadata.name.includes('ÁªÑ‰ª∂')
                }
            })

            const duration = performance.now() - startTime

            displayResult('Â§çÊùÇÊü•ËØ¢ÁªìÊûú', {
                ÂåπÈÖçÊù°‰ª∂: 'Á±ªÂûã=card21-component, ÂêØÁî®=true, ‰ºòÂÖàÁ∫ß>20, Ê†áÁ≠æ>=2‰∏™, ÂêçÁß∞ÂåÖÂê´"ÁªÑ‰ª∂"',
                ÁªìÊûúÊï∞Èáè: complexResults.length,
                Êü•ËØ¢ËÄóÊó∂: `${duration.toFixed(2)}ms`,
                ÂåπÈÖçÁªÑ‰ª∂: complexResults.map(c => ({
                    ÂêçÁß∞: c.metadata.name,
                    ‰ºòÂÖàÁ∫ß: c.metadata.priority,
                    Ê†áÁ≠æÊï∞: c.metadata.tags ? c.metadata.tags.length : 0
                }))
            })

            logMessage(`üéØ Â§çÊùÇÊü•ËØ¢ÂÆåÊàê: ÊâæÂà∞ ${complexResults.length} ‰∏™ÂåπÈÖçÁªÑ‰ª∂`, 'info')
        }

        async function createDependencyChain() {
            logMessage('üîó ÂàõÂª∫‰æùËµñÈìæ...', 'info')

            // ÂàõÂª∫‰æùËµñÈìæ: A -> B -> C
            const componentA = {
                metadata: {
                    id: 'component-a',
                    name: 'ÁªÑ‰ª∂AÔºàÂü∫Á°ÄÊúçÂä°Ôºâ',
                    type: 'data-source',
                    version: '1.0.0',
                    category: 'foundation',
                    tags: ['foundation', 'service'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 100
                },
                content: { level: 'foundation' }
            }

            const componentB = {
                metadata: {
                    id: 'component-b',
                    name: 'ÁªÑ‰ª∂BÔºà‰∏≠Èó¥Â±ÇÔºâ',
                    type: 'renderer',
                    version: '1.0.0',
                    category: 'middleware',
                    tags: ['middleware', 'processor'],
                    dependencies: ['component-a'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 50
                },
                content: { level: 'middleware' }
            }

            const componentC = {
                metadata: {
                    id: 'component-c',
                    name: 'ÁªÑ‰ª∂CÔºàÂ∫îÁî®Â±ÇÔºâ',
                    type: 'card21-component',
                    version: '1.0.0',
                    category: 'application',
                    tags: ['application', 'ui'],
                    dependencies: ['component-b'],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    enabled: true,
                    priority: 10
                },
                content: { level: 'application' }
            }

            await registryEngine.register(componentA)
            await registryEngine.register(componentB)
            await registryEngine.register(componentC)

            updateStats()

            const cDependencies = registryEngine.getDependencies('component-c', true)
            const aDependents = registryEngine.getDependents('component-a', true)

            displayResult('‰æùËµñÈìæÂàõÂª∫ÁªìÊûú', {
                ‰æùËµñÈìæ: 'A <- B <- C',
                ÁªÑ‰ª∂CÁöÑÊâÄÊúâ‰æùËµñ: cDependencies,
                ÁªÑ‰ª∂AÁöÑÊâÄÊúâ‰æùËµñËÄÖ: aDependents
            })

            logMessage('‚úÖ ‰æùËµñÈìæÂàõÂª∫ÂÆåÊàê', 'success')
        }

        function validateDependencies() {
            const allItems = registryEngine.getAll()
            const missingDependencies = []

            for (const item of allItems) {
                if (item.metadata.dependencies) {
                    const missing = item.metadata.dependencies.filter(depId => !registryEngine.has(depId))
                    if (missing.length > 0) {
                        missingDependencies.push({
                            component: item.metadata.id,
                            missing: missing
                        })
                    }
                }
            }

            const isValid = missingDependencies.length === 0

            displayResult('‰æùËµñÈ™åËØÅÁªìÊûú', {
                È™åËØÅÁä∂ÊÄÅ: isValid ? '‚úÖ ÊâÄÊúâ‰æùËµñÂÆåÊï¥' : '‚ùå Â≠òÂú®Áº∫Â§±‰æùËµñ',
                Áº∫Â§±‰æùËµñ: missingDependencies
            })

            if (isValid) {
                logMessage('‚úÖ ‰æùËµñÈ™åËØÅÈÄöËøá', 'success')
            } else {
                logMessage(`‚ö†Ô∏è ÂèëÁé∞ ${missingDependencies.length} ‰∏™‰æùËµñÈóÆÈ¢ò`, 'warn')
            }
        }

        function analyzeDependencies() {
            const allItems = registryEngine.getAll()
            const dependencyAnalysis = {}

            for (const item of allItems) {
                const dependencies = registryEngine.getDependencies(item.metadata.id, false)
                const dependents = registryEngine.getDependents(item.metadata.id, false)

                dependencyAnalysis[item.metadata.id] = {
                    name: item.metadata.name,
                    directDependencies: dependencies.length,
                    directDependents: dependents.length,
                    dependencies: dependencies,
                    dependents: dependents
                }
            }

            displayResult('‰æùËµñÂÖ≥Á≥ªÂàÜÊûê', dependencyAnalysis)
            logMessage('üìä ‰æùËµñÂÖ≥Á≥ªÂàÜÊûêÂÆåÊàê', 'info')
        }

        async function testCircularDependency() {
            logMessage('üîÑ ÊµãËØïÂæ™ÁéØ‰æùËµñÊ£ÄÊµã...', 'warn')

            try {
                // Â∞ùËØïÂàõÂª∫Âæ™ÁéØ‰æùËµñ X -> Y -> X
                const componentX = {
                    metadata: {
                        id: 'component-x',
                        name: 'ÁªÑ‰ª∂X',
                        type: 'card21-component',
                        version: '1.0.0',
                        dependencies: ['component-y'],  // ‰æùËµñY
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 10
                    },
                    content: { circular: true }
                }

                const componentY = {
                    metadata: {
                        id: 'component-y',
                        name: 'ÁªÑ‰ª∂Y',
                        type: 'card21-component',
                        version: '1.0.0',
                        dependencies: ['component-x'],  // ‰æùËµñXÔºåÂΩ¢ÊàêÂæ™ÁéØ
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 10
                    },
                    content: { circular: true }
                }

                // ÂÖàÊ≥®ÂÜåXÔºàY‰∏çÂ≠òÂú®ÔºåÂ∫îËØ•ÊúâË≠¶Âëä‰ΩÜËÉΩÊàêÂäüÔºâ
                await registryEngine.register(componentX)

                // ÂÜçÊ≥®ÂÜåYÔºà‰ºöÂΩ¢ÊàêÂæ™ÁéØ‰æùËµñÔºâ
                await registryEngine.register(componentY)

                updateStats()

                displayResult('Âæ™ÁéØ‰æùËµñÊµãËØï', {
                    ÁªìÊûú: 'Âæ™ÁéØ‰æùËµñÂ∑≤ÂàõÂª∫ÔºàÊºîÁ§∫Áî®ÈÄîÔºâ',
                    ÁªÑ‰ª∂X‰æùËµñ: registryEngine.getDependencies('component-x'),
                    ÁªÑ‰ª∂Y‰æùËµñ: registryEngine.getDependencies('component-y'),
                    Ê≥®ÊÑè: 'ÂÆûÈôÖÁ≥ªÁªü‰∏≠Â∫îËØ•Ê£ÄÊµãÂπ∂ÈòªÊ≠¢Âæ™ÁéØ‰æùËµñ'
                })

                logMessage('‚ö†Ô∏è Âæ™ÁéØ‰æùËµñÊµãËØïÂÆåÊàêÔºà‰ªÖÊºîÁ§∫Ôºâ', 'warn')

            } catch (error) {
                logMessage(`‚ùå Âæ™ÁéØ‰æùËµñÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error')
            }
        }

        async function registerCustomComponent() {
            const id = document.getElementById('customId').value.trim()
            const name = document.getElementById('customName').value.trim()
            const type = document.getElementById('customType').value
            const contentStr = document.getElementById('customContent').value.trim()

            if (!id || !name || !contentStr) {
                logMessage('‚ùå ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÈúÄÂ≠óÊÆµ', 'error')
                return
            }

            try {
                const content = JSON.parse(contentStr)

                const component = {
                    metadata: {
                        id: id,
                        name: name,
                        type: type,
                        version: '1.0.0',
                        description: `Ëá™ÂÆö‰πâ${name}ÁªÑ‰ª∂`,
                        category: 'custom',
                        tags: ['custom', 'user-defined'],
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        enabled: true,
                        priority: 20
                    },
                    content: content,
                    validate: () => {
                        logMessage('üîç È™åËØÅËá™ÂÆö‰πâÁªÑ‰ª∂...', 'info')
                        return true
                    },
                    initialize: async () => {
                        logMessage('üöÄ ÂàùÂßãÂåñËá™ÂÆö‰πâÁªÑ‰ª∂...', 'info')
                    }
                }

                const success = await registryEngine.register(component)
                updateStats()

                if (success) {
                    displayResult('Ëá™ÂÆö‰πâÁªÑ‰ª∂Ê≥®ÂÜå', component.metadata)
                    logMessage(`‚úÖ Ëá™ÂÆö‰πâÁªÑ‰ª∂ ${name} Ê≥®ÂÜåÊàêÂäü`, 'success')
                }

            } catch (error) {
                logMessage(`‚ùå JSONËß£ÊûêÈîôËØØ: ${error.message}`, 'error')
            }
        }

        function queryCustomComponent() {
            const id = document.getElementById('customId').value.trim()

            if (!id) {
                logMessage('‚ùå ËØ∑ËæìÂÖ•ÁªÑ‰ª∂ID', 'error')
                return
            }

            const component = registryEngine.get(id)

            if (component) {
                displayResult('Ëá™ÂÆö‰πâÁªÑ‰ª∂Êü•ËØ¢', {
                    ÊâæÂà∞ÁªÑ‰ª∂: true,
                    ÁªÑ‰ª∂‰ø°ÊÅØ: component.metadata,
                    ÁªÑ‰ª∂ÂÜÖÂÆπ: component.content
                })
                logMessage(`‚úÖ ÊâæÂà∞ÁªÑ‰ª∂: ${component.metadata.name}`, 'success')
            } else {
                displayResult('Ëá™ÂÆö‰πâÁªÑ‰ª∂Êü•ËØ¢', {
                    ÊâæÂà∞ÁªÑ‰ª∂: false,
                    Êü•ËØ¢ID: id
                })
                logMessage(`‚ö†Ô∏è Êú™ÊâæÂà∞ÁªÑ‰ª∂: ${id}`, 'warn')
            }
        }

        async function runPerformanceTest() {
            logMessage('‚ö° ÂºÄÂßãÊÄßËÉΩÊµãËØï...', 'info')

            const testSizes = [10, 50, 100, 200]
            const results = []

            for (const size of testSizes) {
                // Ê≥®ÂÜåÊÄßËÉΩÊµãËØï
                const startTime = performance.now()
                const promises = []

                for (let i = 0; i < size; i++) {
                    const component = {
                        metadata: {
                            id: `perf-test-${size}-${i}`,
                            name: `ÊÄßËÉΩÊµãËØïÁªÑ‰ª∂ ${i}`,
                            type: 'card21-component',
                            version: '1.0.0',
                            category: 'performance',
                            tags: ['performance', 'test'],
                            createdAt: Date.now(),
                            updatedAt: Date.now(),
                            enabled: true,
                            priority: Math.random() * 100
                        },
                        content: { perfTest: true, index: i }
                    }
                    promises.push(registryEngine.register(component))
                }

                await Promise.all(promises)
                const registerTime = performance.now() - startTime

                // Êü•ËØ¢ÊÄßËÉΩÊµãËØï
                const queryStart = performance.now()
                const queryResults = registryEngine.query({
                    category: 'performance',
                    tags: ['test']
                })
                const queryTime = performance.now() - queryStart

                results.push({
                    size: size,
                    registerTime: registerTime.toFixed(2),
                    queryTime: queryTime.toFixed(2),
                    avgRegisterTime: (registerTime / size).toFixed(3),
                    queryResults: queryResults.length
                })

                logMessage(`üìä ÊµãËØï ${size} ‰∏™ÁªÑ‰ª∂: Ê≥®ÂÜå ${registerTime.toFixed(2)}ms, Êü•ËØ¢ ${queryTime.toFixed(2)}ms`, 'info')
            }

            updateStats()

            displayResult('ÊÄßËÉΩÊµãËØïÁªìÊûú', {
                ÊµãËØïËßÑÊ®°: testSizes,
                ËØ¶ÁªÜÁªìÊûú: results,
                ÊÄª‰ΩìÊÄßËÉΩ: registryEngine.getAveragePerformance().toFixed(2) + 'ms/Êìç‰Ωú'
            })

            logMessage('‚úÖ ÊÄßËÉΩÊµãËØïÂÆåÊàê', 'success')
        }

        async function runErrorTest() {
            logMessage('üêõ ÂºÄÂßãÈîôËØØÂ§ÑÁêÜÊµãËØï...', 'warn')

            const errorTests = [
                {
                    name: 'ÈáçÂ§çIDÊ≥®ÂÜå',
                    test: async () => {
                        const comp1 = {
                            metadata: {
                                id: 'duplicate-test',
                                name: 'ÈáçÂ§çÊµãËØï1',
                                type: 'card21-component',
                                version: '1.0.0',
                                createdAt: Date.now(),
                                updatedAt: Date.now(),
                                enabled: true,
                                priority: 10
                            },
                            content: {}
                        }

                        const comp2 = { ...comp1, metadata: { ...comp1.metadata, name: 'ÈáçÂ§çÊµãËØï2' } }

                        const result1 = await registryEngine.register(comp1)
                        const result2 = await registryEngine.register(comp2)

                        return { result1, result2 }
                    }
                },
                {
                    name: 'Êó†ÊïàÂÖÉÊï∞ÊçÆ',
                    test: async () => {
                        const invalidComp = {
                            metadata: {
                                id: '',  // Á©∫ID
                                name: '',  // Á©∫ÂêçÁß∞
                                type: 'invalid-type',
                                version: '1.0.0',
                                createdAt: Date.now(),
                                updatedAt: Date.now(),
                                enabled: true,
                                priority: 10
                            },
                            content: {}
                        }

                        return await registryEngine.register(invalidComp)
                    }
                },
                {
                    name: 'È™åËØÅÂ§±Ë¥•',
                    test: async () => {
                        const failingComp = {
                            metadata: {
                                id: 'validation-fail-test',
                                name: 'È™åËØÅÂ§±Ë¥•ÊµãËØï',
                                type: 'card21-component',
                                version: '1.0.0',
                                createdAt: Date.now(),
                                updatedAt: Date.now(),
                                enabled: true,
                                priority: 10
                            },
                            content: {},
                            validate: () => {
                                throw new Error('È™åËØÅËøáÁ®ã‰∏≠ÂèëÁîüÂºÇÂ∏∏')
                            }
                        }

                        return await registryEngine.register(failingComp)
                    }
                }
            ]

            const errorResults = {}

            for (const errorTest of errorTests) {
                try {
                    const result = await errorTest.test()
                    errorResults[errorTest.name] = {
                        ÁªìÊûú: result,
                        Áä∂ÊÄÅ: 'ÊµãËØïÂÆåÊàê'
                    }
                } catch (error) {
                    errorResults[errorTest.name] = {
                        ÈîôËØØ: error.message,
                        Áä∂ÊÄÅ: 'ÊçïËé∑ÂºÇÂ∏∏'
                    }
                }
            }

            updateStats()

            displayResult('ÈîôËØØÂ§ÑÁêÜÊµãËØïÁªìÊûú', errorResults)
            logMessage('‚úÖ ÈîôËØØÂ§ÑÁêÜÊµãËØïÂÆåÊàê', 'success')
        }

        async function clearAllData() {
            logMessage('üßπ Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ...', 'warn')
            await registryEngine.clear()
            updateStats()

            // Ê∏ÖÁ©∫ÁªìÊûúÊòæÁ§∫
            document.getElementById('resultDisplay').innerHTML = ''

            displayResult('Êï∞ÊçÆÊ∏ÖÁêÜ', {
                Áä∂ÊÄÅ: 'ÊâÄÊúâÊ≥®ÂÜåÈ°πÂ∑≤Ê∏ÖÁ©∫',
                Ê∏ÖÁêÜÊó∂Èó¥: new Date().toLocaleString()
            })

            logMessage('‚úÖ Êï∞ÊçÆÊ∏ÖÁêÜÂÆåÊàê', 'success')
        }

        // ‰∫ã‰ª∂ÁõëÂê¨Âô®
        registryEngine.on('register', (metadata) => {
            updateStats()
        })

        registryEngine.on('unregister', (id) => {
            updateStats()
        })

        registryEngine.on('error', (errorInfo) => {
            console.error('Registry Engine Error:', errorInfo)
        })

        // ÂÆöÊúüÊõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
        setInterval(updateStats, 2000)

        // ÂàùÂßãÂåñ
        window.addEventListener('load', () => {
            logMessage('üéâ Registry Engine ÊºîÁ§∫Á≥ªÁªüÂ∑≤Â∞±Áª™', 'success')
            updateStats()
        })
    </script>
</body>
</html>