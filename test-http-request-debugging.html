<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🔍 HTTP 请求调试测试</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }
    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 32px;
      text-align: center;
    }
    .test-header h1 {
      margin: 0 0 12px 0;
      font-size: 28px;
    }
    .test-header p {
      margin: 0;
      font-size: 16px;
      opacity: 0.9;
    }
    .test-section {
      margin-bottom: 40px;
      padding: 24px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: #fafafa;
    }
    .test-section h3 {
      margin: 0 0 20px 0;
      color: #333;
      font-size: 20px;
    }
    .step {
      margin-bottom: 20px;
      padding: 16px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid #2080f0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .step h4 {
      margin: 0 0 12px 0;
      color: #333;
      font-size: 16px;
    }
    .step p {
      margin: 0;
      color: #666;
      font-size: 14px;
      line-height: 1.6;
    }
    .step ul {
      margin: 8px 0 0 0;
      color: #666;
      font-size: 14px;
    }
    .step li {
      margin-bottom: 4px;
    }
    .debug-alert {
      background: #fff3cd;
      border-left-color: #ffc107;
      border: 1px solid #ffeeba;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .debug-alert h4 {
      color: #856404;
      margin: 0 0 8px 0;
    }
    .debug-alert p {
      color: #856404;
      margin: 0;
    }
    .issue-critical {
      background: #fff1f0;
      border-left-color: #ff4d4f;
    }
    .issue-critical h4 {
      color: #ff4d4f;
    }
    .nav-link {
      display: inline-block;
      padding: 12px 24px;
      background: #2080f0;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      margin-right: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .nav-link:hover {
      background: #40a9ff;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(32,128,240,0.3);
    }
    .code-block {
      background: #f8f8f8;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #333;
      margin: 16px 0;
      border: 1px solid #e0e0e0;
      overflow-x: auto;
    }
    .debug-steps {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
    }
    .debug-steps h4 {
      color: #0958d9;
      margin: 0 0 12px 0;
    }
    .debug-steps ol {
      margin: 0;
      padding-left: 20px;
      color: #0958d9;
    }
    .debug-steps li {
      margin-bottom: 8px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>🔍 HTTP 请求调试测试</h1>
      <p>详细调试 DataItemFetcher HTTP 请求执行链路，找出请求未发出的根本原因</p>
    </div>

    <div class="test-section">
      <h3>🎯 问题诊断</h3>
      
      <div class="step issue-critical">
        <h4>🚨 核心问题确认</h4>
        <p>根据用户反馈："HTTP请求发出 - 没有发出 ！"，虽然整个属性绑定链路正常工作，但最终的 HTTP 请求没有实际发送到网络。</p>
      </div>

      <div class="debug-alert">
        <h4>🔧 调试策略</h4>
        <p>在 DataItemFetcher.fetchHttpData 方法中添加了详细的调试日志，现在可以完整跟踪从配置解析到请求发送的每一步。</p>
      </div>

      <div class="step">
        <h4>📊 调试信息覆盖范围</h4>
        <ul>
          <li><strong>配置解析</strong>：HTTP 配置对象的结构和参数数量</li>
          <li><strong>参数处理</strong>：路径参数、查询参数、请求头的解析和应用</li>
          <li><strong>URL 构建</strong>：最终请求 URL 的生成过程</li>
          <li><strong>请求发送</strong>：实际 HTTP 请求的发送状态</li>
          <li><strong>响应处理</strong>：HTTP 响应的接收和处理结果</li>
          <li><strong>错误处理</strong>：任何执行过程中的异常和错误</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>🧪 详细调试步骤</h3>
      
      <div class="debug-steps">
        <h4>🔍 执行调试测试</h4>
        <ol>
          <li><strong>打开数据源系统测试页面</strong> - 访问测试环境</li>
          <li><strong>配置 HTTP 数据源</strong> - 设置带有属性绑定的 HTTP 数据源</li>
          <li><strong>修改基础配置</strong> - 改变 deviceId 或 metricsList 触发重新执行</li>
          <li><strong>观察浏览器控制台</strong> - 查看详细的调试日志</li>
          <li><strong>检查网络面板</strong> - 确认 HTTP 请求是否实际发出</li>
        </ol>
      </div>

      <div class="step">
        <h4>步骤 1：访问测试环境</h4>
        <p>打开数据源系统测试页面，准备进行调试</p>
        <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
          🔗 数据源系统测试
        </a>
      </div>

      <div class="step">
        <h4>步骤 2：配置和触发测试</h4>
        <p><strong>关键操作</strong>：</p>
        <ul>
          <li>找到任何带有 HTTP 配置的组件</li>
          <li>在基础配置中修改 deviceId 或其他属性</li>
          <li>观察 InteractionManager 是否触发重新执行</li>
          <li>检查 DataItemFetcher 是否接收到正确的 HTTP 配置</li>
        </ul>
      </div>

      <div class="step">
        <h4>步骤 3：控制台日志分析</h4>
        <p><strong>需要关注的日志</strong>：</p>
        <div class="code-block">
🚀 [DataItemFetcher] fetchHttpData 开始执行
📡 [DataItemFetcher] 准备发送HTTP请求
🔄 [DataItemFetcher] 发送GET/POST请求: [URL]
✅ [DataItemFetcher] HTTP请求成功响应
        </div>
        <p>如果看不到 "发送GET/POST请求" 日志，说明问题在请求发送前；如果看到但网络面板没有请求，则可能是 request 库的问题。</p>
      </div>
    </div>

    <div class="test-section">
      <h3>🔧 可能的问题点和解决方案</h3>
      
      <div class="step">
        <h4>🔍 可能原因1：配置格式问题</h4>
        <p>VisualEditorBridge 传递给 DataItemFetcher 的配置格式不正确</p>
        <ul>
          <li>检查 HTTP 配置对象是否包含必要的字段（url、method）</li>
          <li>验证参数数组格式是否正确</li>
          <li>确认基础配置的 deviceId 是否正确注入到 HTTP 配置中</li>
        </ul>
      </div>

      <div class="step">
        <h4>🔍 可能原因2：参数解析失败</h4>
        <p>属性绑定的参数值无法正确解析，导致请求无法构建</p>
        <ul>
          <li>检查 resolveParameterValue 方法是否返回正确的值</li>
          <li>验证组件属性绑定路径解析是否成功</li>
          <li>确认参数类型转换是否正确</li>
        </ul>
      </div>

      <div class="step">
        <h4>🔍 可能原因3：Request 库问题</h4>
        <p>项目的 request 库可能存在配置或权限问题</p>
        <ul>
          <li>检查 request 库是否正确导入</li>
          <li>验证请求拦截器是否正常工作</li>
          <li>确认是否有权限或 CORS 问题</li>
        </ul>
      </div>

      <div class="step">
        <h4>🔍 可能原因4：异步执行问题</h4>
        <p>HTTP 请求在异步执行过程中被取消或中断</p>
        <ul>
          <li>检查是否有异步执行竞争条件</li>
          <li>验证 Promise 链是否正常</li>
          <li>确认没有意外的 catch 块吞掉错误</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>📊 预期调试结果</h3>
      
      <div class="step">
        <h4>✅ 正常情况下的日志流</h4>
        <div class="code-block">
🔧 [InteractionManager] 基础配置变更检测到
🚀 [InteractionManager] 触发HTTP数据源重新执行: componentId
🔍 [VisualEditorBridge] updateComponentExecutor 开始
🚀 [DataItemFetcher] fetchHttpData 开始执行
🛤️ [DataItemFetcher] 处理路径参数/查询参数
📡 [DataItemFetcher] 准备发送HTTP请求
🔄 [DataItemFetcher] 发送GET请求: [完整URL]
✅ [DataItemFetcher] HTTP请求成功响应
        </div>
      </div>

      <div class="step">
        <h4>❌ 如果请求未发出的调试线索</h4>
        <ul>
          <li><strong>日志中断在配置解析</strong>：配置格式问题</li>
          <li><strong>日志中断在参数处理</strong>：参数解析问题</li>
          <li><strong>日志中断在请求准备</strong>：URL 构建问题</li>
          <li><strong>看到"准备发送"但没有"发送XXX请求"</strong>：request 方法选择问题</li>
          <li><strong>看到"发送XXX请求"但网络面板无请求</strong>：request 库问题</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h3>🔗 相关测试链接</h3>
      <a href="http://localhost:5002/test/data-source-system" class="nav-link" target="_blank">
        数据源系统测试
      </a>
      <a href="http://localhost:5002/test/data-binding-system-integration" class="nav-link" target="_blank">
        数据绑定系统集成测试
      </a>
      <a href="http://localhost:5002/test/editor-integration" class="nav-link" target="_blank">
        编辑器集成测试
      </a>
    </div>

    <div class="test-section">
      <h3>🎯 下一步行动</h3>
      
      <div class="step">
        <h4>立即执行调试测试</h4>
        <p>使用上面的调试步骤，现在就可以准确定位 HTTP 请求未发出的原因。详细的日志将显示执行链路的每一步，帮助快速找到问题所在。</p>
      </div>

      <div class="step">
        <h4>根据调试结果制定修复策略</h4>
        <p>基于控制台日志的输出，我们可以精确判断问题发生在哪个环节，然后针对性地修复相应的代码。</p>
      </div>
    </div>
  </div>
</body>
</html>