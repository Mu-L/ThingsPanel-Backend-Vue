<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card2.1 自动注册系统测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1, h2 {
            color: #2c3e50;
            margin-bottom: 16px;
        }
        
        .overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .component-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }
        
        .component-table th,
        .component-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .component-table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .component-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-right: 4px;
        }
        
        .button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .button:hover {
            background: #3367d6;
        }
        
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        
        .code {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 Card2.1 自动注册系统测试</h1>
        <p>这个页面测试新的组件自动注册系统，验证是否能够正确发现和注册所有组件。</p>
        
        <button class="button" onclick="runTest()">🔄 运行测试</button>
        <button class="button" onclick="showDebugInfo()">🐛 显示调试信息</button>
        
        <div id="results" class="loading">点击"运行测试"开始...</div>
    </div>

    <script type="module">
        let components = [];
        let stats = {};
        
        async function runTest() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="loading">正在测试自动注册系统...</div>';
            
            try {
                // 模拟组件数据（在实际环境中这些会从自动注册系统获取）
                const mockComponents = [
                    {
                        type: 'simple-display',
                        name: '简单数据显示',
                        category: '数据展示',
                        version: '1.0.0',
                        supportedDataSources: ['api', 'websocket'],
                        tags: ['基础', '数据']
                    },
                    {
                        type: 'dual-data-display', 
                        name: '双数据显示',
                        category: '数据展示',
                        version: '1.0.0',
                        supportedDataSources: ['api', 'websocket'],
                        tags: ['双栏', '数据']
                    },
                    {
                        type: 'triple-data-display',
                        name: '三重数据显示', 
                        category: '数据展示',
                        version: '1.0.0',
                        supportedDataSources: ['api', 'websocket', 'static'],
                        tags: ['三栏', '数据']
                    },
                    {
                        type: 'alarm-count',
                        name: '告警计数',
                        category: '统计类',
                        version: '1.0.0',
                        supportedDataSources: ['api', 'websocket'],
                        tags: ['告警', '统计']
                    },
                    {
                        type: 'access-num',
                        name: '访问统计',
                        category: '统计类', 
                        version: '1.0.0',
                        supportedDataSources: ['api'],
                        tags: ['访问', '统计']
                    }
                ];
                
                components = mockComponents;
                
                // 生成统计信息
                stats = {
                    total: components.length,
                    categories: [...new Set(components.map(c => c.category))],
                    byCategory: components.reduce((acc, c) => {
                        acc[c.category] = (acc[c.category] || 0) + 1;
                        return acc;
                    }, {}),
                    supportedDataSources: [...new Set(components.flatMap(c => c.supportedDataSources))],
                    versions: [...new Set(components.map(c => c.version).filter(Boolean))]
                };
                
                displayResults();
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="container">
                        <h2 class="error">❌ 测试失败</h2>
                        <p>错误信息: ${error.message}</p>
                        <div class="code">${error.stack}</div>
                    </div>
                `;
            }
        }
        
        function displayResults() {
            const validation = validateComponents();
            
            document.getElementById('results').innerHTML = `
                <!-- 概览统计 -->
                <div class="container">
                    <h2>📊 组件概览</h2>
                    <div class="overview">
                        <div class="stat-card">
                            <div class="stat-number">${stats.total}</div>
                            <div class="stat-label">总组件数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.categories.length}</div>
                            <div class="stat-label">分类数量</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.supportedDataSources.length}</div>
                            <div class="stat-label">数据源类型</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.versions.length}</div>
                            <div class="stat-label">版本数量</div>
                        </div>
                    </div>
                </div>
                
                <!-- 验证结果 -->
                <div class="container">
                    <h2>✅ 验证结果</h2>
                    <div class="${validation.valid ? 'success' : 'warning'}">
                        ${validation.valid ? 
                            '<strong>✓ 所有组件验证通过！</strong>' : 
                            '<strong>⚠ 发现以下问题：</strong><ul>' + 
                            validation.issues.map(issue => '<li>' + issue + '</li>').join('') + 
                            '</ul>'
                        }
                    </div>
                </div>
                
                <!-- 分类统计 -->
                <div class="container">
                    <h2>📂 分类统计</h2>
                    ${Object.entries(stats.byCategory).map(([category, count]) => 
                        `<div style="margin: 8px 0;"><strong>${category}:</strong> <span class="tag">${count} 个组件</span></div>`
                    ).join('')}
                </div>
                
                <!-- 组件详情 -->
                <div class="container">
                    <h2>🧩 组件详情</h2>
                    <table class="component-table">
                        <thead>
                            <tr>
                                <th>类型</th>
                                <th>名称</th>
                                <th>分类</th>
                                <th>版本</th>
                                <th>数据源</th>
                                <th>标签</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${components.map(c => `
                                <tr>
                                    <td><code>${c.type}</code></td>
                                    <td>${c.name}</td>
                                    <td>${c.category}</td>
                                    <td>${c.version || '未指定'}</td>
                                    <td>${c.supportedDataSources?.join(', ') || '无'}</td>
                                    <td>${c.tags?.map(tag => `<span class="tag">${tag}</span>`).join('') || '无'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <!-- 使用指南 -->
                <div class="container">
                    <h2>💡 自动注册系统优势</h2>
                    <ul>
                        <li>✅ <strong>零维护</strong>：新增组件无需修改 index.ts 文件</li>
                        <li>✅ <strong>自动发现</strong>：支持任意深度的目录结构</li>
                        <li>✅ <strong>实时更新</strong>：支持热重载和动态刷新</li>
                        <li>✅ <strong>类型安全</strong>：完整的 TypeScript 支持</li>
                        <li>✅ <strong>向后兼容</strong>：现有代码无需修改</li>
                    </ul>
                    
                    <h3>📁 新增组件步骤</h3>
                    <div class="code">1. 创建组件目录：mkdir -p src/card2.1/components/分类名/组件名
2. 创建 index.ts 文件并导出组件定义
3. 创建 index.vue 组件实现
4. 完成！组件会自动注册并出现在编辑器中</div>
                    
                    <h3>🔧 API 使用示例</h3>
                    <div class="code">import { 
  getAllComponents,
  getComponentsByCategory,
  getComponentDefinition,
  debugComponents 
} from '@/card2.1/components'

// 获取所有组件
const components = getAllComponents()

// 获取指定分类的组件
const dataComponents = getComponentsByCategory('数据展示')

// 调试信息
debugComponents()</div>
                </div>
            `;
        }
        
        function validateComponents() {
            const issues = [];
            
            for (const component of components) {
                // 检查必需字段
                if (!component.type) issues.push(`组件缺少 type 字段: ${component.name}`);
                if (!component.name) issues.push(`组件缺少 name 字段: ${component.type}`);
                
                // 检查类型命名规范
                if (component.type && !/^[a-z0-9-]+$/.test(component.type)) {
                    issues.push(`组件类型命名不规范 (应为 kebab-case): ${component.type}`);
                }
                
                // 检查版本格式
                if (component.version && !/^\d+\.\d+\.\d+/.test(component.version)) {
                    issues.push(`组件版本格式不正确: ${component.type} - ${component.version}`);
                }
            }
            
            return { valid: issues.length === 0, issues };
        }
        
        function showDebugInfo() {
            console.group('[Card2.1 组件调试信息]');
            console.log('统计信息:', stats);
            console.log('所有分类:', stats.categories);
            console.log('组件详情:', components);
            console.table(components.map(c => ({
                类型: c.type,
                名称: c.name,
                分类: c.category,
                版本: c.version || '未指定',
                数据源: c.supportedDataSources?.join(', ') || '无',
                标签: c.tags?.join(', ') || '无'
            })));
            console.groupEnd();
            
            alert('调试信息已输出到控制台，请按 F12 查看');
        }
        
        // 全局暴露函数
        window.runTest = runTest;
        window.showDebugInfo = showDebugInfo;
    </script>
</body>
</html>