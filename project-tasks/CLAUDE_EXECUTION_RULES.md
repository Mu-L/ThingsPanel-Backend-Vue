# Claude 任务执行规则 - 每次对话必读

**⚠️ 此文档是 Claude 每次对话的执行规则，必须严格遵守！**

## 🚨 强制执行原则

### 1. 文档阅读顺序（每次对话开始必须执行）
```
1. 读取本文档 (CLAUDE_EXECUTION_RULES.md) - 了解执行规则
2. 读取 current-main-objective.md - 确认当前大任务
3. 读取 current-subtask.md - 确认当前小任务
4. 读取 user-approval-status.md - 确认用户授权状态
```

### 2. 执行状态控制
- **未获得用户明确同意，绝对禁止开始任何任务执行**
- **每个小任务执行前必须等待用户确认"开始执行"**
- **每个小任务完成后必须等待用户确认"继续下一个"**
- **用户未确认时，只能汇报状态，不能执行任务**

### 3. 任务调整机制
- **发现大任务需要调整时，立即停止当前执行**
- **等待用户确认大任务调整方案**
- **大任务调整后必须重新拆解小任务**
- **新的小任务拆解完成后等待用户确认**

## 📋 强制执行流程

### Phase 1: 对话开始检查
```markdown
□ 读取 CLAUDE_EXECUTION_RULES.md (本文档)
□ 读取 current-main-objective.md 
□ 读取 current-subtask.md
□ 读取 user-approval-status.md
□ 汇报当前状态给用户
□ 等待用户指令
```

### Phase 2: 用户指令处理
```markdown
如果用户要求制定新大任务：
□ 与用户沟通大任务需求
□ 在 current-main-objective.md 中记录大任务
□ 更新 user-approval-status.md 为 "waiting_for_breakdown_approval"
□ 等待用户确认

如果用户要求拆解任务：
□ 将大任务拆解为小任务
□ 在 active-breakdown.md 中记录所有小任务
□ 更新 user-approval-status.md 为 "waiting_for_execution_approval"
□ 等待用户确认

如果用户授权开始执行：
□ 更新 user-approval-status.md 为 "execution_approved"
□ 开始执行 current-subtask.md 中的当前小任务
□ 执行完成后等待用户确认继续
```

### Phase 3: 任务执行控制
```markdown
执行中检查点 (每30分钟)：
□ 检查是否偏离任务边界
□ 检查是否发现需要调整大任务的情况
□ 向用户汇报执行进度
□ 确认是否需要调整

任务完成时必须执行：
□ 创建详细的完成记录文件（使用subtask-completion-template.md）
□ 记录所有产出物的位置和说明
□ 记录执行过程中的问题和解决方案
□ 更新 subtask-completion-log.md
□ 等待用户确认继续下一个任务

发现需要调整大任务时：
□ 立即停止当前执行
□ 向用户汇报调整需求和原因
□ 等待用户确认调整方案
□ 重新拆解任务后等待确认
```

## 🔒 绝对禁止行为

### 执行控制违规
- ❌ 没有用户明确同意就开始任务执行
- ❌ 跳过用户确认流程
- ❌ 自行决定任务优先级或顺序
- ❌ 在用户未确认的情况下调整大任务

### 任务边界违规  
- ❌ 扩展小任务范围
- ❌ 同时执行多个小任务
- ❌ "顺便"处理其他问题
- ❌ 在任务完成前开始其他工作

### 沟通违规
- ❌ 汇报格式不规范
- ❌ 不按时检查执行状态
- ❌ 发现问题不及时汇报
- ❌ 主动建议而不等待用户决策

## 📊 标准汇报格式

### 状态汇报模板
```markdown
## 当前状态汇报
- 当前大任务: [大任务名称]
- 当前小任务: [小任务名称] 
- 执行状态: [waiting/in_progress/completed/need_adjustment]
- 用户授权状态: [详见 user-approval-status.md]
- 发现的问题: [如有]
- 等待用户决策: [具体需要用户确认的内容]
```

### 完成汇报模板
```markdown
## 任务完成汇报
- 已完成任务: [任务名称]
- 执行时间: [实际用时]
- 交付成果: [具体成果描述]
- 发现的问题: [需要关注的问题]
- 大任务影响: [是否需要调整大任务]
- 下一步行动: 等待用户确认继续执行下一个小任务
```

## 🎯 文档更新责任

### Claude 必须更新的文档
```markdown
每次执行后必须更新：
□ current-subtask.md - 更新任务状态
□ subtask-completion-log.md - 记录完成情况  
□ user-approval-status.md - 更新授权状态
□ 04-completed-tasks/[日期]-[任务名称].md - 创建详细完成记录

发现问题时必须更新：
□ interruption-log.md - 记录中断和问题
□ current-main-objective.md - 如需调整大任务
```

### 文档更新时机
- **任务开始前**: 更新状态为 in_progress
- **每30分钟**: 更新执行进度
- **任务完成后**: 
  - 创建详细完成记录文件
  - 更新状态为 completed
  - 等待用户确认
- **发现问题时**: 立即记录到相应文档

### 完成记录文件命名规范
- **文件位置**: `/04-completed-tasks/`
- **命名格式**: `[YYYY-MM-DD]-[任务简短名称]-completion.md`
- **示例**: `2024-08-27-多数据源架构沟通-completion.md`

## 🔄 异常情况处理

### 技术阻塞
```markdown
1. 立即停止执行
2. 详细记录阻塞原因到 interruption-log.md
3. 向用户汇报阻塞情况
4. 等待用户决策是否需要调整任务
```

### 发现大任务需要调整
```markdown
1. 立即停止当前小任务执行
2. 向用户详细说明调整需求
3. 等待用户确认调整方案
4. 获得确认后更新 current-main-objective.md
5. 重新拆解小任务并等待用户确认
```

### 用户长时间无响应
```markdown
1. 保持当前状态不变
2. 不得自行决定下一步行动
3. 可以提供状态总结但不执行任务
4. 等待用户回归后的明确指令
```

---

## 📝 执行检查清单

**每次对话开始时**:
- [ ] 已读取所有必需文档
- [ ] 了解当前大任务和小任务状态  
- [ ] 确认用户授权状态
- [ ] 准备好标准汇报格式

**执行任务时**:
- [ ] 获得用户明确授权
- [ ] 严格按小任务边界执行
- [ ] 每30分钟检查和汇报
- [ ] 完成后立即停止等待确认

**异常情况时**:
- [ ] 立即停止并汇报
- [ ] 详细记录问题原因
- [ ] 等待用户决策
- [ ] 不得自行调整方案

---

**🚨 提醒：每次对话必须首先阅读此规则文档，严格按照流程执行！**